!function(e,t){"function"==typeof define&&define.amd?define("@oa/vxe-table-plugin-export-xlsx",["exports","xe-utils","exceljs"],t):"undefined"!=typeof exports?t(exports,require("xe-utils"),require("exceljs")):(t(t={},e.XEUtils,e.ExcelJS),e.VXETablePluginExportXLSX=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e,j,M){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}var N;Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.VXETablePluginExportXLSX=void 0,j=t(j),M=t(M);var O="f8f8f9",R="606266",o="thin",n="e8eaec";function V(e,t){if(t)switch(e.cellType){case"string":return j.default.toValueString(t);case"number":if(!isNaN(t))return Number(t);break;default:if(t.length<12&&!isNaN(t))return Number(t)}return t}function A(e,t){t&&(e.height=j.default.floor(.75*t,12))}function B(e,t){e.protection={locked:!1},e.alignment={vertical:"middle",horizontal:t||"left"}}function D(){return{top:{style:o,color:{argb:n}},left:{style:o,color:{argb:n}},bottom:{style:o,color:{argb:n}},right:{style:o,color:{argb:n}}}}function r(e){var a="xlsx",r=e.$table,l=e.options,i=e.columns,t=e.colgroups,o=e.datas,n=r.props,s=r.reactData,c=n.headerAlign,u=n.align,f=n.footerAlign,d=s.rowHeight,e=l.message,g=l.sheetName,p=l.isHeader,h=l.isFooter,n=l.isMerge,s=l.isColgroup,m=l.original,b=l.useStyle,x=l.sheetMethod,v=!1!==e,e=r.getMergeCells(),y=[],w=[],E=[],k=[],C=0,T={};i.forEach(function(e){var t=e.id,o=e.property,n=e.renderWidth;T[t]=m?o:e.getTitle(),E.push({key:t,width:j.default.ceil(n/8,1)})}),p&&(s&&!m&&t?t.forEach(function(e,a){var l={};i.forEach(function(e){l[e.id]=null}),e.forEach(function(e){var t=e._colSpan,o=e._rowSpan,n=function e(t){var o=t.childNodes;return o&&o.length?e(o[0]):t}(e),r=i.indexOf(n);l[n.id]=m?n.property:e.getTitle(),(1<t||1<o)&&k.push({s:{r:a,c:r},e:{r:a+o-1,c:r+t-1}})}),y.push(l)}):y.push(T),C+=y.length),n&&!m&&e.forEach(function(e){var t=e.row,o=e.rowspan,n=e.col,e=e.colspan;k.push({s:{r:t+C,c:n},e:{r:t+C+o-1,c:n+e-1}})});var X,S=o.map(function(t){var o={};return i.forEach(function(e){o[e.id]=V(e,t[e.id])}),o});C+=S.length,h&&(_=r.getTableData().footerData,e=_,_=(X=l.footerFilterMethod)?e.filter(function(e,t){return X({items:e,$rowIndex:t})}):e,e=r.getMergeFooterItems(),n&&!m&&e.forEach(function(e){var t=e.row,o=e.rowspan,n=e.col,e=e.colspan;k.push({s:{r:t+C,c:n},e:{r:t+C+o-1,c:n+e-1}})}),_.forEach(function(t){var o={};i.forEach(function(e){o[e.id]=V(e=e,t[r.getVMColumnIndex(e)])}),w.push(o)}));var _=function(){var e=new M.default.Workbook,n=e.addWorksheet(g);e.creator="vxe-table",n.columns=E,p&&n.addRows(y).forEach(function(e){b&&A(e,d),e.eachCell(function(e){var t=n.getColumn(e.col),o=r.getColumnById(t.key),t=o.headerAlign,o=o.align;B(e,t||o||c||u),b&&Object.assign(e,{font:{bold:!0,color:{argb:R}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:O}},border:D()})})}),n.addRows(S).forEach(function(e){b&&A(e,d),e.eachCell(function(e){var t=n.getColumn(e.col);B(e,r.getColumnById(t.key).align||u),b&&Object.assign(e,{font:{color:{argb:R}},border:D()})})}),h&&n.addRows(w).forEach(function(e){b&&A(e,d),e.eachCell(function(e){var t=n.getColumn(e.col),o=r.getColumnById(t.key),t=o.footerAlign,o=o.align;B(e,t||o||f||u),b&&Object.assign(e,{font:{color:{argb:R}},border:D()})})}),b&&x&&x({options:l,workbook:e,worksheet:n,columns:i,colgroups:t,datas:o,$table:r}),k.forEach(function(e){var t=e.s,e=e.e;n.mergeCells(t.r+1,t.c+1,e.r+1,e.c+1)}),e.xlsx.writeBuffer().then(function(e){var t,o,n,r=new Blob([e],{type:"application/octet-stream"});t=r,n=(o=l).message,e=o.filename,r=o.type,o=!1!==n,window.Blob?((n=document.createElement("a")).target="_blank",n.download="".concat(e,".").concat(r),n.href=URL.createObjectURL(t),document.body.appendChild(n),n.click(),document.body.removeChild(n)):o&&N.modal.alert({message:N.t("vxe.error.notExp"),status:"error"}),v&&(N.modal.close(a),N.modal.message({message:N.t("vxe.table.expSuccess"),status:"success"}))})};v?(N.modal.message({id:a,message:N.t("vxe.table.expLoading"),status:"loading",duration:-1}),setTimeout(_,1500)):_()}function u(e){var t=e.$table,e=e.options,t=t.internalData._importReject;!1!==e.message&&N.modal.message({message:N.t("vxe.error.impFields"),status:"error"}),t&&t({status:!1})}function a(a){var l=a.$table,o=a.columns,i=a.options,e=a.file,s=l.internalData._importResolve,c=!1!==i.message,t=new FileReader;t.onerror=function(){u(a)},t.onload=function(e){var r=[];o.forEach(function(e){e=e.property;e&&r.push(e)});var t=new M.default.Workbook,e=e.target;e?t.xlsx.load(e.result).then(function(e){var n,t,o=e.worksheets[0];o?(e=o.getSheetValues(),o=j.default.findIndexOf(e,function(e){return e&&0<e.length}),n=e[o],(t=r,n.some(function(e){return-1<t.indexOf(e)}))?(o=e.slice(o).map(function(e){var o={};e.forEach(function(e,t){o[n[t]]=e});var t={};return r.forEach(function(e){t[e]=j.default.isUndefined(o[e])?null:o[e]}),t}),l.createData(o).then(function(e){e="insert"===i.mode?l.insertAt(e,-1):l.reloadData(e);return e.then(function(){s&&s({status:!0})})}),c&&N.modal.message({message:N.t("vxe.table.impSuccess",[o.length]),status:"success"})):u(a)):u(a)}):u(a)},t.readAsArrayBuffer(e)}function l(e){if("xlsx"===e.options.type)return a(e),!1}function i(e){if("xlsx"===e.options.type)return r(e),!1}var s={install:function(e){var t=e.setup,o=e.interceptor;N=e,t({export:{types:{xlsx:0}}}),o.mixin({"event.import":l,"event.export":i})}};e.VXETablePluginExportXLSX=s,"undefined"!=typeof window&&window.VXETable&&window.VXETable.use(s),e.default=s});