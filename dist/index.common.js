"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginExportXLSX = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils"));

var _exceljs = _interopRequireDefault(require("exceljs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var vxetable;
var defaultHeaderBackgroundColor = 'f8f8f9';
var defaultCellFontColor = '606266';
var defaultCellBorderStyle = 'thin';
var defaultCellBorderColor = 'e8eaec';

function getCellLabel(column, cellValue) {
  if (cellValue) {
    switch (column.cellType) {
      case 'string':
        return _xeUtils["default"].toValueString(cellValue);

      case 'number':
        if (!isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;

      default:
        if (cellValue.length < 12 && !isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;
    }
  }

  return cellValue;
}

function getFooterData(opts, footerData) {
  var footerFilterMethod = opts.footerFilterMethod;
  return footerFilterMethod ? footerData.filter(function (items, index) {
    return footerFilterMethod({
      items: items,
      $rowIndex: index
    });
  }) : footerData;
}

function getFooterCellValue($table, opts, rows, column) {
  var cellValue = getCellLabel(column, rows[$table.getVMColumnIndex(column)]);
  return cellValue;
}

function getValidColumn(column) {
  var childNodes = column.childNodes;
  var isColGroup = childNodes && childNodes.length;

  if (isColGroup) {
    return getValidColumn(childNodes[0]);
  }

  return column;
}

function setExcelRowHeight(excelRow, height) {
  if (height) {
    excelRow.height = _xeUtils["default"].floor(height * 0.75, 12);
  }
}

function setExcelCellStyle(excelCell, align) {
  excelCell.protection = {
    locked: false
  };
  excelCell.alignment = {
    vertical: 'middle',
    horizontal: align || 'left'
  };
}

function getDefaultBorderStyle() {
  return {
    top: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    left: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    bottom: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    right: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    }
  };
}

function exportXLSX(params) {
  var msgKey = 'xlsx';
  var $table = params.$table,
      options = params.options,
      columns = params.columns,
      colgroups = params.colgroups,
      datas = params.datas;
  var props = $table.props,
      reactData = $table.reactData;
  var allHeaderAlign = props.headerAlign,
      allAlign = props.align,
      allFooterAlign = props.footerAlign;
  var rowHeight = reactData.rowHeight;
  var message = options.message,
      sheetName = options.sheetName,
      isHeader = options.isHeader,
      isFooter = options.isFooter,
      isMerge = options.isMerge,
      isColgroup = options.isColgroup,
      original = options.original,
      useStyle = options.useStyle,
      sheetMethod = options.sheetMethod;
  var showMsg = message !== false;
  var mergeCells = $table.getMergeCells();
  var colList = [];
  var footList = [];
  var sheetCols = [];
  var sheetMerges = [];
  var beforeRowCount = 0;
  var colHead = {};
  columns.forEach(function (column) {
    var id = column.id,
        property = column.property,
        renderWidth = column.renderWidth;
    colHead[id] = original ? property : column.getTitle();
    sheetCols.push({
      key: id,
      width: _xeUtils["default"].ceil(renderWidth / 8, 1)
    });
  }); // 处理表头

  if (isHeader) {
    // 处理分组
    if (isColgroup && !original && colgroups) {
      colgroups.forEach(function (cols, rIndex) {
        var groupHead = {};
        columns.forEach(function (column) {
          groupHead[column.id] = null;
        });
        cols.forEach(function (column) {
          var _colSpan = column._colSpan,
              _rowSpan = column._rowSpan;
          var validColumn = getValidColumn(column);
          var columnIndex = columns.indexOf(validColumn);
          groupHead[validColumn.id] = original ? validColumn.property : column.getTitle();

          if (_colSpan > 1 || _rowSpan > 1) {
            sheetMerges.push({
              s: {
                r: rIndex,
                c: columnIndex
              },
              e: {
                r: rIndex + _rowSpan - 1,
                c: columnIndex + _colSpan - 1
              }
            });
          }
        });
        colList.push(groupHead);
      });
    } else {
      colList.push(colHead);
    }

    beforeRowCount += colList.length;
  } // 处理合并


  if (isMerge && !original) {
    mergeCells.forEach(function (mergeItem) {
      var mergeRowIndex = mergeItem.row,
          mergeRowspan = mergeItem.rowspan,
          mergeColIndex = mergeItem.col,
          mergeColspan = mergeItem.colspan;
      sheetMerges.push({
        s: {
          r: mergeRowIndex + beforeRowCount,
          c: mergeColIndex
        },
        e: {
          r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
          c: mergeColIndex + mergeColspan - 1
        }
      });
    });
  }

  var rowList = datas.map(function (item) {
    var rest = {};
    columns.forEach(function (column) {
      rest[column.id] = getCellLabel(column, item[column.id]);
    });
    return rest;
  });
  beforeRowCount += rowList.length; // 处理表尾

  if (isFooter) {
    var _$table$getTableData = $table.getTableData(),
        footerData = _$table$getTableData.footerData;

    var footers = getFooterData(options, footerData);
    var mergeFooterItems = $table.getMergeFooterItems(); // 处理合并

    if (isMerge && !original) {
      mergeFooterItems.forEach(function (mergeItem) {
        var mergeRowIndex = mergeItem.row,
            mergeRowspan = mergeItem.rowspan,
            mergeColIndex = mergeItem.col,
            mergeColspan = mergeItem.colspan;
        sheetMerges.push({
          s: {
            r: mergeRowIndex + beforeRowCount,
            c: mergeColIndex
          },
          e: {
            r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
            c: mergeColIndex + mergeColspan - 1
          }
        });
      });
    }

    footers.forEach(function (rows) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = getFooterCellValue($table, options, rows, column);
      });
      footList.push(item);
    });
  }

  var exportMethod = function exportMethod() {
    var workbook = new _exceljs["default"].Workbook();
    var sheet = workbook.addWorksheet(sheetName);
    workbook.creator = 'vxe-table';
    sheet.columns = sheetCols;

    if (isHeader) {
      sheet.addRows(colList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);
          var headerAlign = column.headerAlign,
              align = column.align;
          setExcelCellStyle(excelCell, headerAlign || align || allHeaderAlign || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                bold: true,
                color: {
                  argb: defaultCellFontColor
                }
              },
              fill: {
                type: 'pattern',
                pattern: 'solid',
                fgColor: {
                  argb: defaultHeaderBackgroundColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        });
      });
    }

    sheet.addRows(rowList).forEach(function (excelRow) {
      if (useStyle) {
        setExcelRowHeight(excelRow, rowHeight);
      }

      excelRow.eachCell(function (excelCell) {
        var excelCol = sheet.getColumn(excelCell.col);
        var column = $table.getColumnById(excelCol.key);
        var align = column.align;
        setExcelCellStyle(excelCell, align || allAlign);

        if (useStyle) {
          Object.assign(excelCell, {
            font: {
              color: {
                argb: defaultCellFontColor
              }
            },
            border: getDefaultBorderStyle()
          });
        }
      });
    });

    if (isFooter) {
      sheet.addRows(footList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);
          var footerAlign = column.footerAlign,
              align = column.align;
          setExcelCellStyle(excelCell, footerAlign || align || allFooterAlign || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                color: {
                  argb: defaultCellFontColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        });
      });
    }

    if (useStyle && sheetMethod) {
      sheetMethod({
        options: options,
        workbook: workbook,
        worksheet: sheet,
        columns: columns,
        colgroups: colgroups,
        datas: datas,
        $table: $table
      });
    }

    sheetMerges.forEach(function (_ref) {
      var s = _ref.s,
          e = _ref.e;
      sheet.mergeCells(s.r + 1, s.c + 1, e.r + 1, e.c + 1);
    });
    workbook.xlsx.writeBuffer().then(function (buffer) {
      var blob = new Blob([buffer], {
        type: 'application/octet-stream'
      }); // 导出 xlsx

      downloadFile(params, blob, options);

      if (showMsg) {
        vxetable.modal.close(msgKey);
        vxetable.modal.message({
          message: vxetable.t('vxe.table.expSuccess'),
          status: 'success'
        });
      }
    });
  };

  if (showMsg) {
    vxetable.modal.message({
      id: msgKey,
      message: vxetable.t('vxe.table.expLoading'),
      status: 'loading',
      duration: -1
    });
    setTimeout(exportMethod, 1500);
  } else {
    exportMethod();
  }
}

function downloadFile(params, blob, options) {
  var message = options.message,
      filename = options.filename,
      type = options.type;
  var showMsg = message !== false;

  if (window.Blob) {
    var linkElem = document.createElement('a');
    linkElem.target = '_blank';
    linkElem.download = "".concat(filename, ".").concat(type);
    linkElem.href = URL.createObjectURL(blob);
    document.body.appendChild(linkElem);
    linkElem.click();
    document.body.removeChild(linkElem);
  } else {
    if (showMsg) {
      vxetable.modal.alert({
        message: vxetable.t('vxe.error.notExp'),
        status: 'error'
      });
    }
  }
}

function checkImportData(tableFields, fields) {
  return fields.some(function (field) {
    return tableFields.indexOf(field) > -1;
  });
}

function importError(params) {
  var $table = params.$table,
      options = params.options;
  var internalData = $table.internalData;
  var _importReject = internalData._importReject;
  var showMsg = options.message !== false;

  if (showMsg) {
    vxetable.modal.message({
      message: vxetable.t('vxe.error.impFields'),
      status: 'error'
    });
  }

  if (_importReject) {
    _importReject({
      status: false
    });
  }
}

function importXLSX(params) {
  var $table = params.$table,
      columns = params.columns,
      options = params.options,
      file = params.file;
  var internalData = $table.internalData;
  var _importResolve = internalData._importResolve;
  var showMsg = options.message !== false;
  var fileReader = new FileReader();

  fileReader.onerror = function () {
    importError(params);
  };

  fileReader.onload = function (evnt) {
    var tableFields = [];
    columns.forEach(function (column) {
      var field = column.property;

      if (field) {
        tableFields.push(field);
      }
    });
    var workbook = new _exceljs["default"].Workbook();
    var readerTarget = evnt.target;

    if (readerTarget) {
      workbook.xlsx.load(readerTarget.result).then(function (wb) {
        var firstSheet = wb.worksheets[0];

        if (firstSheet) {
          var sheetValues = firstSheet.getSheetValues();

          var fieldIndex = _xeUtils["default"].findIndexOf(sheetValues, function (list) {
            return list && list.length > 0;
          });

          var fields = sheetValues[fieldIndex];
          var status = checkImportData(tableFields, fields);

          if (status) {
            var records = sheetValues.slice(fieldIndex).map(function (list) {
              var item = {};
              list.forEach(function (cellValue, cIndex) {
                item[fields[cIndex]] = cellValue;
              });
              var record = {};
              tableFields.forEach(function (field) {
                record[field] = _xeUtils["default"].isUndefined(item[field]) ? null : item[field];
              });
              return record;
            });
            $table.createData(records).then(function (data) {
              var loadRest;

              if (options.mode === 'insert') {
                loadRest = $table.insertAt(data, -1);
              } else {
                loadRest = $table.reloadData(data);
              }

              return loadRest.then(function () {
                if (_importResolve) {
                  _importResolve({
                    status: true
                  });
                }
              });
            });

            if (showMsg) {
              vxetable.modal.message({
                message: vxetable.t('vxe.table.impSuccess', [records.length]),
                status: 'success'
              });
            }
          } else {
            importError(params);
          }
        } else {
          importError(params);
        }
      });
    } else {
      importError(params);
    }
  };

  fileReader.readAsArrayBuffer(file);
}

function handleImportEvent(params) {
  if (params.options.type === 'xlsx') {
    importXLSX(params);
    return false;
  }
}

function handleExportEvent(params) {
  if (params.options.type === 'xlsx') {
    exportXLSX(params);
    return false;
  }
}
/**
 * 基于 vxe-table 表格的增强插件，支持导出 xlsx 格式
 */


var VXETablePluginExportXLSX = {
  install: function install(vxetablecore) {
    var setup = vxetablecore.setup,
        interceptor = vxetablecore.interceptor;
    vxetable = vxetablecore;
    setup({
      "export": {
        types: {
          xlsx: 0
        }
      }
    });
    interceptor.mixin({
      'event.import': handleImportEvent,
      'event.export': handleExportEvent
    });
  }
};
exports.VXETablePluginExportXLSX = VXETablePluginExportXLSX;

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginExportXLSX);
}

var _default = VXETablePluginExportXLSX;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiaW5kZXguanMiXSwibmFtZXMiOlsidnhldGFibGUiLCJkZWZhdWx0SGVhZGVyQmFja2dyb3VuZENvbG9yIiwiZGVmYXVsdENlbGxGb250Q29sb3IiLCJkZWZhdWx0Q2VsbEJvcmRlclN0eWxlIiwiZGVmYXVsdENlbGxCb3JkZXJDb2xvciIsImdldENlbGxMYWJlbCIsImNvbHVtbiIsImNlbGxWYWx1ZSIsImNlbGxUeXBlIiwiWEVVdGlscyIsInRvVmFsdWVTdHJpbmciLCJpc05hTiIsIk51bWJlciIsImxlbmd0aCIsImdldEZvb3RlckRhdGEiLCJvcHRzIiwiZm9vdGVyRGF0YSIsImZvb3RlckZpbHRlck1ldGhvZCIsImZpbHRlciIsIml0ZW1zIiwiaW5kZXgiLCIkcm93SW5kZXgiLCJnZXRGb290ZXJDZWxsVmFsdWUiLCIkdGFibGUiLCJyb3dzIiwiZ2V0Vk1Db2x1bW5JbmRleCIsImdldFZhbGlkQ29sdW1uIiwiY2hpbGROb2RlcyIsImlzQ29sR3JvdXAiLCJzZXRFeGNlbFJvd0hlaWdodCIsImV4Y2VsUm93IiwiaGVpZ2h0IiwiZmxvb3IiLCJzZXRFeGNlbENlbGxTdHlsZSIsImV4Y2VsQ2VsbCIsImFsaWduIiwicHJvdGVjdGlvbiIsImxvY2tlZCIsImFsaWdubWVudCIsInZlcnRpY2FsIiwiaG9yaXpvbnRhbCIsImdldERlZmF1bHRCb3JkZXJTdHlsZSIsInRvcCIsInN0eWxlIiwiY29sb3IiLCJhcmdiIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0IiwiZXhwb3J0WExTWCIsInBhcmFtcyIsIm1zZ0tleSIsIm9wdGlvbnMiLCJjb2x1bW5zIiwiY29sZ3JvdXBzIiwiZGF0YXMiLCJwcm9wcyIsInJlYWN0RGF0YSIsImFsbEhlYWRlckFsaWduIiwiaGVhZGVyQWxpZ24iLCJhbGxBbGlnbiIsImFsbEZvb3RlckFsaWduIiwiZm9vdGVyQWxpZ24iLCJyb3dIZWlnaHQiLCJtZXNzYWdlIiwic2hlZXROYW1lIiwiaXNIZWFkZXIiLCJpc0Zvb3RlciIsImlzTWVyZ2UiLCJpc0NvbGdyb3VwIiwib3JpZ2luYWwiLCJ1c2VTdHlsZSIsInNoZWV0TWV0aG9kIiwic2hvd01zZyIsIm1lcmdlQ2VsbHMiLCJnZXRNZXJnZUNlbGxzIiwiY29sTGlzdCIsImZvb3RMaXN0Iiwic2hlZXRDb2xzIiwic2hlZXRNZXJnZXMiLCJiZWZvcmVSb3dDb3VudCIsImNvbEhlYWQiLCJmb3JFYWNoIiwiaWQiLCJwcm9wZXJ0eSIsInJlbmRlcldpZHRoIiwiZ2V0VGl0bGUiLCJwdXNoIiwia2V5Iiwid2lkdGgiLCJjZWlsIiwiY29scyIsInJJbmRleCIsImdyb3VwSGVhZCIsIl9jb2xTcGFuIiwiX3Jvd1NwYW4iLCJ2YWxpZENvbHVtbiIsImNvbHVtbkluZGV4IiwiaW5kZXhPZiIsInMiLCJyIiwiYyIsImUiLCJtZXJnZUl0ZW0iLCJtZXJnZVJvd0luZGV4Iiwicm93IiwibWVyZ2VSb3dzcGFuIiwicm93c3BhbiIsIm1lcmdlQ29sSW5kZXgiLCJjb2wiLCJtZXJnZUNvbHNwYW4iLCJjb2xzcGFuIiwicm93TGlzdCIsIm1hcCIsIml0ZW0iLCJyZXN0IiwiZ2V0VGFibGVEYXRhIiwiZm9vdGVycyIsIm1lcmdlRm9vdGVySXRlbXMiLCJnZXRNZXJnZUZvb3Rlckl0ZW1zIiwiZXhwb3J0TWV0aG9kIiwid29ya2Jvb2siLCJFeGNlbEpTIiwiV29ya2Jvb2siLCJzaGVldCIsImFkZFdvcmtzaGVldCIsImNyZWF0b3IiLCJhZGRSb3dzIiwiZWFjaENlbGwiLCJleGNlbENvbCIsImdldENvbHVtbiIsImdldENvbHVtbkJ5SWQiLCJPYmplY3QiLCJhc3NpZ24iLCJmb250IiwiYm9sZCIsImZpbGwiLCJ0eXBlIiwicGF0dGVybiIsImZnQ29sb3IiLCJib3JkZXIiLCJ3b3Jrc2hlZXQiLCJ4bHN4Iiwid3JpdGVCdWZmZXIiLCJ0aGVuIiwiYnVmZmVyIiwiYmxvYiIsIkJsb2IiLCJkb3dubG9hZEZpbGUiLCJtb2RhbCIsImNsb3NlIiwidCIsInN0YXR1cyIsImR1cmF0aW9uIiwic2V0VGltZW91dCIsImZpbGVuYW1lIiwid2luZG93IiwibGlua0VsZW0iLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0YXJnZXQiLCJkb3dubG9hZCIsImhyZWYiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJjbGljayIsInJlbW92ZUNoaWxkIiwiYWxlcnQiLCJjaGVja0ltcG9ydERhdGEiLCJ0YWJsZUZpZWxkcyIsImZpZWxkcyIsInNvbWUiLCJmaWVsZCIsImltcG9ydEVycm9yIiwiaW50ZXJuYWxEYXRhIiwiX2ltcG9ydFJlamVjdCIsImltcG9ydFhMU1giLCJmaWxlIiwiX2ltcG9ydFJlc29sdmUiLCJmaWxlUmVhZGVyIiwiRmlsZVJlYWRlciIsIm9uZXJyb3IiLCJvbmxvYWQiLCJldm50IiwicmVhZGVyVGFyZ2V0IiwibG9hZCIsInJlc3VsdCIsIndiIiwiZmlyc3RTaGVldCIsIndvcmtzaGVldHMiLCJzaGVldFZhbHVlcyIsImdldFNoZWV0VmFsdWVzIiwiZmllbGRJbmRleCIsImZpbmRJbmRleE9mIiwibGlzdCIsInJlY29yZHMiLCJzbGljZSIsImNJbmRleCIsInJlY29yZCIsImlzVW5kZWZpbmVkIiwiY3JlYXRlRGF0YSIsImRhdGEiLCJsb2FkUmVzdCIsIm1vZGUiLCJpbnNlcnRBdCIsInJlbG9hZERhdGEiLCJyZWFkQXNBcnJheUJ1ZmZlciIsImhhbmRsZUltcG9ydEV2ZW50IiwiaGFuZGxlRXhwb3J0RXZlbnQiLCJWWEVUYWJsZVBsdWdpbkV4cG9ydFhMU1giLCJpbnN0YWxsIiwidnhldGFibGVjb3JlIiwic2V0dXAiLCJpbnRlcmNlcHRvciIsInR5cGVzIiwibWl4aW4iLCJWWEVUYWJsZSIsInVzZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQVFBOzs7O0FBRUEsSUFBSUEsUUFBSjtBQWlCQSxJQUFNQyw0QkFBNEIsR0FBRyxRQUFyQztBQUNBLElBQU1DLG9CQUFvQixHQUFHLFFBQTdCO0FBQ0EsSUFBTUMsc0JBQXNCLEdBQUcsTUFB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UCxDQUFlcUYsSUFBZixLQUF3QixNQUE1QixFQUFvQztBQUNsQ3lDLElBQUFBLFVBQVUsQ0FBQ2hJLE1BQUQsQ0FBVjtBQUNBLFdBQU8sS0FBUDtBQUNEO0FBQ0Y7O0FBRUQsU0FBU2dLLGlCQUFULENBQTRCaEssTUFBNUIsRUFBdUY7QUFDckYsTUFBSUEsTUFBTSxDQUFDRSxPQUFQLENBQWVxRixJQUFmLEtBQXdCLE1BQTVCLEVBQW9DO0FBQ2xDeEYsSUFBQUEsVUFBVSxDQUFDQyxNQUFELENBQVY7QUFDQSxXQUFPLEtBQVA7QUFDRDtBQUNGO0FBRUQ7QUMvQkE7QUFDQTs7O0FEaUNPLElBQU1pSyx3QkFBd0IsR0FBRztBQUN0Q0MsRUFBQUEsT0FEc0MsbUJBQzdCQyxZQUQ2QixFQUNIO0FBQUEsUUFDekJDLEtBRHlCLEdBQ0ZELFlBREUsQ0FDekJDLEtBRHlCO0FBQUEsUUFDbEJDLFdBRGtCLEdBQ0ZGLFlBREUsQ0FDbEJFLFdBRGtCO0FBR2pDdk4sSUFBQUEsUUFBUSxHQUFHcU4sWUFBWDtBQUVBQyxJQUFBQSxLQUFLLENBQUM7QUFDSixnQkFBUTtBQUNORSxRQUFBQSxLQUFLLEVBQUU7QUFDTDFFLFVBQUFBLElBQUksRUFBRTtBQUREO0FBREQ7QUFESixLQUFELENBQUw7QUFPQXlFLElBQUFBLFdBQVcsQ0FBQ0UsS0FBWixDQUFrQjtBQUNoQixzQkFBZ0JSLGlCQURBO0FBRWhCLHNCQUFnQkM7QUFGQSxLQUFsQjtBQUlEO0FBakJxQyxDQUFqQzs7O0FBb0JQLElBQUksT0FBT3RELE1BQVAsS0FBa0IsV0FBbEIsSUFBaUNBLE1BQU0sQ0FBQzhELFFBQTVDLEVBQXNEO0FBQ3BEOUQsRUFBQUEsTUFBTSxDQUFDOEQsUUFBUCxDQUFnQkMsR0FBaEIsQ0FBb0JSLHdCQUFwQjtBQUNEOztlQUVjQSx3QiIsImZpbGUiOiJpbmRleC5jb21tb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgWEVVdGlscyBmcm9tICd4ZS11dGlscydcbmltcG9ydCB7XG4gIFZYRVRhYmxlQ29yZSxcbiAgVnhlVGFibGVDb25zdHJ1Y3RvcixcbiAgVnhlVGFibGVQcm9wVHlwZXMsXG4gIFZ4ZVRhYmxlRGVmaW5lcyxcbiAgVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzXG59IGZyb20gJ0BvYS92eGUtdGFibGUnXG5pbXBvcnQgRXhjZWxKUyBmcm9tICdleGNlbGpzJ1xuXG5sZXQgdnhldGFibGU6VlhFVGFibGVDb3JlXG5cbmRlY2xhcmUgbW9kdWxlICdAb2EvdnhlLXRhYmxlJyB7XG4gIG5hbWVzcGFjZSBWeGVUYWJsZURlZmluZXMge1xuICAgIGludGVyZmFjZSBFeHRvcnRTaGVldE1ldGhvZFBhcmFtcyB7XG4gICAgICB3b3JrYm9vazogRXhjZWxKUy5Xb3JrYm9vaztcbiAgICAgIHdvcmtzaGVldDogRXhjZWxKUy5Xb3Jrc2hlZXQ7XG4gICAgfVxuICAgIGludGVyZmFjZSBDb2x1bW5JbmZvIHtcbiAgICAgIF9yb3c6IGFueTtcbiAgICAgIF9jb2xTcGFuOiBudW1iZXI7XG4gICAgICBfcm93U3BhbjogbnVtYmVyO1xuICAgICAgY2hpbGROb2RlczogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm9bXTtcbiAgICB9XG4gIH1cbn1cblxuY29uc3QgZGVmYXVsdEhlYWRlckJhY2tncm91bmRDb2xvciA9ICdmOGY4ZjknXG5jb25zdCBkZWZhdWx0Q2VsbEZvbnRDb2xvciA9ICc2MDYyNjYnXG5jb25zdCBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlID0gJ3RoaW4nXG5jb25zdCBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yID0gJ2U4ZWFlYydcblxuZnVuY3Rpb24gZ2V0Q2VsbExhYmVsIChjb2x1bW46IFZ4ZVRhYmxlRGVmaW5lcy5Db2x1bW5JbmZvLCBjZWxsVmFsdWU6IGFueSkge1xuICBpZiAoY2VsbFZhbHVlKSB7XG4gICAgc3dpdGNoIChjb2x1bW4uY2VsbFR5cGUpIHtcbiAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgIHJldHVybiBYRVV0aWxzLnRvVmFsdWVTdHJpbmcoY2VsbFZhbHVlKVxuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgaWYgKCFpc05hTihjZWxsVmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIE51bWJlcihjZWxsVmFsdWUpXG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmIChjZWxsVmFsdWUubGVuZ3RoIDwgMTIgJiYgIWlzTmFOKGNlbGxWYWx1ZSkpIHtcbiAgICAgICAgICByZXR1cm4gTnVtYmVyKGNlbGxWYWx1ZSlcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuICAgIH1cbiAgfVxuICByZXR1cm4gY2VsbFZhbHVlXG59XG5cbmZ1bmN0aW9uIGdldEZvb3RlckRhdGEgKG9wdHM6IFZ4ZVRhYmxlUHJvcFR5cGVzLkV4cG9ydENvbmZpZywgZm9vdGVyRGF0YTogYW55W11bXSkge1xuICBjb25zdCB7IGZvb3RlckZpbHRlck1ldGhvZCB9ID0gb3B0c1xuICByZXR1cm4gZm9vdGVyRmlsdGVyTWV0aG9kID8gZm9vdGVyRGF0YS5maWx0ZXIoKGl0ZW1zLCBpbmRleCkgPT4gZm9vdGVyRmlsdGVyTWV0aG9kKHsgaXRlbXMsICRyb3dJbmRleDogaW5kZXggfSkpIDogZm9vdGVyRGF0YVxufVxuXG5mdW5jdGlvbiBnZXRGb290ZXJDZWxsVmFsdWUgKCR0YWJsZTogVnhlVGFibGVDb25zdHJ1Y3Rvciwgb3B0czogVnhlVGFibGVQcm9wVHlwZXMuRXhwb3J0Q29uZmlnLCByb3dzOiBhbnlbXSwgY29sdW1uOiBWeGVUYWJsZURlZmluZXMuQ29sdW1uSW5mbykge1xuICBjb25zdCBjZWxsVmFsdWUgPSBnZXRDZWxsTGFiZWwoY29sdW1uLCByb3dzWyR0YWJsZS5nZXRWTUNvbHVtbkluZGV4KGNvbHVtbildKVxuICByZXR1cm4gY2VsbFZhbHVlXG59XG5cbmZ1bmN0aW9uIGdldFZhbGlkQ29sdW1uIChjb2x1bW46IFZ4ZVRhYmxlRGVmaW5lcy5Db2x1bW5JbmZvKTogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8ge1xuICBjb25zdCB7IGNoaWxkTm9kZXMgfSA9IGNvbHVtblxuICBjb25zdCBpc0NvbEdyb3VwID0gY2hpbGROb2RlcyAmJiBjaGlsZE5vZGVzLmxlbmd0aFxuICBpZiAoaXNDb2xHcm91cCkge1xuICAgIHJldHVybiBnZXRWYWxpZENvbHVtbihjaGlsZE5vZGVzWzBdKVxuICB9XG4gIHJldHVybiBjb2x1bW5cbn1cblxuZnVuY3Rpb24gc2V0RXhjZWxSb3dIZWlnaHQgKGV4Y2VsUm93OiBFeGNlbEpTLlJvdywgaGVpZ2h0OiBudW1iZXIpIHtcbiAgaWYgKGhlaWdodCkge1xuICAgIGV4Y2VsUm93LmhlaWdodCA9IFhFVXRpbHMuZmxvb3IoaGVpZ2h0ICogMC43NSwgMTIpXG4gIH1cbn1cblxuZnVuY3Rpb24gc2V0RXhjZWxDZWxsU3R5bGUgKGV4Y2VsQ2VsbDogRXhjZWxKUy5DZWxsLCBhbGlnbj86IFZ4ZVRhYmxlUHJvcFR5cGVzLkFsaWduIHwgVnhlVGFibGVQcm9wVHlwZXMuSGVhZGVyQWxpZ24gfCBWeGVUYWJsZVByb3BUeXBlcy5Gb290ZXJBbGlnbikge1xuICBleGNlbENlbGwucHJvdGVjdGlvbiA9IHtcbiAgICBsb2NrZWQ6IGZhbHNlXG4gIH1cbiAgZXhjZWxDZWxsLmFsaWdubWVudCA9IHtcbiAgICB2ZXJ0aWNhbDogJ21pZGRsZScsXG4gICAgaG9yaXpvbnRhbDogYWxpZ24gfHwgJ2xlZnQnXG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RGVmYXVsdEJvcmRlclN0eWxlICgpIHtcbiAgcmV0dXJuIHtcbiAgICB0b3A6IHtcbiAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxuICAgICAgY29sb3I6IHtcbiAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxuICAgICAgfVxuICAgIH0sXG4gICAgbGVmdDoge1xuICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICBjb2xvcjoge1xuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXG4gICAgICB9XG4gICAgfSxcbiAgICBib3R0b206IHtcbiAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxuICAgICAgY29sb3I6IHtcbiAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxuICAgICAgfVxuICAgIH0sXG4gICAgcmlnaHQ6IHtcbiAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxuICAgICAgY29sb3I6IHtcbiAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHBvcnRYTFNYIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckV4cG9ydFBhcmFtcykge1xuICBjb25zdCBtc2dLZXkgPSAneGxzeCdcbiAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMsIGNvbHVtbnMsIGNvbGdyb3VwcywgZGF0YXMgfSA9IHBhcmFtc1xuICBjb25zdCB7IHByb3BzLCByZWFjdERhdGEgfSA9ICR0YWJsZVxuICBjb25zdCB7IGhlYWRlckFsaWduOiBhbGxIZWFkZXJBbGlnbiwgYWxpZ246IGFsbEFsaWduLCBmb290ZXJBbGlnbjogYWxsRm9vdGVyQWxpZ24gfSA9IHByb3BzXG4gIGNvbnN0IHsgcm93SGVpZ2h0IH0gPSByZWFjdERhdGFcbiAgY29uc3QgeyBtZXNzYWdlLCBzaGVldE5hbWUsIGlzSGVhZGVyLCBpc0Zvb3RlciwgaXNNZXJnZSwgaXNDb2xncm91cCwgb3JpZ2luYWwsIHVzZVN0eWxlLCBzaGVldE1ldGhvZCB9ID0gb3B0aW9uc1xuICBjb25zdCBzaG93TXNnID0gbWVzc2FnZSAhPT0gZmFsc2VcbiAgY29uc3QgbWVyZ2VDZWxscyA9ICR0YWJsZS5nZXRNZXJnZUNlbGxzKClcbiAgY29uc3QgY29sTGlzdDogYW55W10gPSBbXVxuICBjb25zdCBmb290TGlzdDogYW55W10gPSBbXVxuICBjb25zdCBzaGVldENvbHM6IGFueVtdID0gW11cbiAgY29uc3Qgc2hlZXRNZXJnZXM6IHsgczogeyByOiBudW1iZXIsIGM6IG51bWJlciB9LCBlOiB7IHI6IG51bWJlciwgYzogbnVtYmVyIH0gfVtdID0gW11cbiAgbGV0IGJlZm9yZVJvd0NvdW50ID0gMFxuICBjb25zdCBjb2xIZWFkOiBhbnkgPSB7fVxuICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgIGNvbnN0IHsgaWQsIHByb3BlcnR5LCByZW5kZXJXaWR0aCB9ID0gY29sdW1uXG4gICAgY29sSGVhZFtpZF0gPSBvcmlnaW5hbCA/IHByb3BlcnR5IDogY29sdW1uLmdldFRpdGxlKClcbiAgICBzaGVldENvbHMucHVzaCh7XG4gICAgICBrZXk6IGlkLFxuICAgICAgd2lkdGg6IFhFVXRpbHMuY2VpbChyZW5kZXJXaWR0aCAvIDgsIDEpXG4gICAgfSlcbiAgfSlcbiAgLy8g5aSE55CG6KGo5aS0XG4gIGlmIChpc0hlYWRlcikge1xuICAgIC8vIOWkhOeQhuWIhue7hFxuICAgIGlmIChpc0NvbGdyb3VwICYmICFvcmlnaW5hbCAmJiBjb2xncm91cHMpIHtcbiAgICAgIGNvbGdyb3Vwcy5mb3JFYWNoKChjb2xzLCBySW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgZ3JvdXBIZWFkOiBhbnkgPSB7fVxuICAgICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgIGdyb3VwSGVhZFtjb2x1bW4uaWRdID0gbnVsbFxuICAgICAgICB9KVxuICAgICAgICBjb2xzLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgX2NvbFNwYW4sIF9yb3dTcGFuIH0gPSBjb2x1bW5cbiAgICAgICAgICBjb25zdCB2YWxpZENvbHVtbiA9IGdldFZhbGlkQ29sdW1uKGNvbHVtbilcbiAgICAgICAgICBjb25zdCBjb2x1bW5JbmRleCA9IGNvbHVtbnMuaW5kZXhPZih2YWxpZENvbHVtbilcbiAgICAgICAgICBncm91cEhlYWRbdmFsaWRDb2x1bW4uaWRdID0gb3JpZ2luYWwgPyB2YWxpZENvbHVtbi5wcm9wZXJ0eSA6IGNvbHVtbi5nZXRUaXRsZSgpXG4gICAgICAgICAgaWYgKF9jb2xTcGFuID4gMSB8fCBfcm93U3BhbiA+IDEpIHtcbiAgICAgICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xuICAgICAgICAgICAgICBzOiB7IHI6IHJJbmRleCwgYzogY29sdW1uSW5kZXggfSxcbiAgICAgICAgICAgICAgZTogeyByOiBySW5kZXggKyBfcm93U3BhbiAtIDEsIGM6IGNvbHVtbkluZGV4ICsgX2NvbFNwYW4gLSAxIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBjb2xMaXN0LnB1c2goZ3JvdXBIZWFkKVxuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgY29sTGlzdC5wdXNoKGNvbEhlYWQpXG4gICAgfVxuICAgIGJlZm9yZVJvd0NvdW50ICs9IGNvbExpc3QubGVuZ3RoXG4gIH1cbiAgLy8g5aSE55CG5ZCI5bm2XG4gIGlmIChpc01lcmdlICYmICFvcmlnaW5hbCkge1xuICAgIG1lcmdlQ2VsbHMuZm9yRWFjaChtZXJnZUl0ZW0gPT4ge1xuICAgICAgY29uc3QgeyByb3c6IG1lcmdlUm93SW5kZXgsIHJvd3NwYW46IG1lcmdlUm93c3BhbiwgY29sOiBtZXJnZUNvbEluZGV4LCBjb2xzcGFuOiBtZXJnZUNvbHNwYW4gfSA9IG1lcmdlSXRlbVxuICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XG4gICAgICAgIHM6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50LCBjOiBtZXJnZUNvbEluZGV4IH0sXG4gICAgICAgIGU6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50ICsgbWVyZ2VSb3dzcGFuIC0gMSwgYzogbWVyZ2VDb2xJbmRleCArIG1lcmdlQ29sc3BhbiAtIDEgfVxuICAgICAgfSlcbiAgICB9KVxuICB9XG4gIGNvbnN0IHJvd0xpc3QgPSBkYXRhcy5tYXAoaXRlbSA9PiB7XG4gICAgY29uc3QgcmVzdDogYW55ID0ge31cbiAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgcmVzdFtjb2x1bW4uaWRdID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgaXRlbVtjb2x1bW4uaWRdKVxuICAgIH0pXG4gICAgcmV0dXJuIHJlc3RcbiAgfSlcbiAgYmVmb3JlUm93Q291bnQgKz0gcm93TGlzdC5sZW5ndGhcbiAgLy8g5aSE55CG6KGo5bC+XG4gIGlmIChpc0Zvb3Rlcikge1xuICAgIGNvbnN0IHsgZm9vdGVyRGF0YSB9ID0gJHRhYmxlLmdldFRhYmxlRGF0YSgpXG4gICAgY29uc3QgZm9vdGVycyA9IGdldEZvb3RlckRhdGEob3B0aW9ucywgZm9vdGVyRGF0YSlcbiAgICBjb25zdCBtZXJnZUZvb3Rlckl0ZW1zID0gJHRhYmxlLmdldE1lcmdlRm9vdGVySXRlbXMoKVxuICAgIC8vIOWkhOeQhuWQiOW5tlxuICAgIGlmIChpc01lcmdlICYmICFvcmlnaW5hbCkge1xuICAgICAgbWVyZ2VGb290ZXJJdGVtcy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcm93OiBtZXJnZVJvd0luZGV4LCByb3dzcGFuOiBtZXJnZVJvd3NwYW4sIGNvbDogbWVyZ2VDb2xJbmRleCwgY29sc3BhbjogbWVyZ2VDb2xzcGFuIH0gPSBtZXJnZUl0ZW1cbiAgICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XG4gICAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcbiAgICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfVxuICAgIGZvb3RlcnMuZm9yRWFjaCgocm93cykgPT4ge1xuICAgICAgY29uc3QgaXRlbTogYW55ID0ge31cbiAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgIGl0ZW1bY29sdW1uLmlkXSA9IGdldEZvb3RlckNlbGxWYWx1ZSgkdGFibGUsIG9wdGlvbnMsIHJvd3MsIGNvbHVtbilcbiAgICAgIH0pXG4gICAgICBmb290TGlzdC5wdXNoKGl0ZW0pXG4gICAgfSlcbiAgfVxuICBjb25zdCBleHBvcnRNZXRob2QgPSAoKSA9PiB7XG4gICAgY29uc3Qgd29ya2Jvb2sgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpXG4gICAgY29uc3Qgc2hlZXQgPSB3b3JrYm9vay5hZGRXb3Jrc2hlZXQoc2hlZXROYW1lKVxuICAgIHdvcmtib29rLmNyZWF0b3IgPSAndnhlLXRhYmxlJ1xuICAgIHNoZWV0LmNvbHVtbnMgPSBzaGVldENvbHNcbiAgICBpZiAoaXNIZWFkZXIpIHtcbiAgICAgIHNoZWV0LmFkZFJvd3MoY29sTGlzdCkuZm9yRWFjaChleGNlbFJvdyA9PiB7XG4gICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpXG4gICAgICAgIH1cbiAgICAgICAgZXhjZWxSb3cuZWFjaENlbGwoZXhjZWxDZWxsID0+IHtcbiAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKVxuICAgICAgICAgIGNvbnN0IGNvbHVtbjogYW55ID0gJHRhYmxlLmdldENvbHVtbkJ5SWQoZXhjZWxDb2wua2V5IGFzIHN0cmluZylcbiAgICAgICAgICBjb25zdCB7IGhlYWRlckFsaWduLCBhbGlnbiB9ID0gY29sdW1uXG4gICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBoZWFkZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxIZWFkZXJBbGlnbiB8fCBhbGxBbGlnbilcbiAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXhjZWxDZWxsLCB7XG4gICAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdwYXR0ZXJuJyxcbiAgICAgICAgICAgICAgICBwYXR0ZXJuOiAnc29saWQnLFxuICAgICAgICAgICAgICAgIGZnQ29sb3I6IHtcbiAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRIZWFkZXJCYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGJvcmRlcjogZ2V0RGVmYXVsdEJvcmRlclN0eWxlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9XG4gICAgc2hlZXQuYWRkUm93cyhyb3dMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcbiAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KVxuICAgICAgfVxuICAgICAgZXhjZWxSb3cuZWFjaENlbGwoZXhjZWxDZWxsID0+IHtcbiAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbClcbiAgICAgICAgY29uc3QgY29sdW1uOiBhbnkgPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkgYXMgc3RyaW5nKVxuICAgICAgICBjb25zdCB7IGFsaWduIH0gPSBjb2x1bW5cbiAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBhbGlnbiB8fCBhbGxBbGlnbilcbiAgICAgICAgaWYgKHVzZVN0eWxlKSB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihleGNlbENlbGwsIHtcbiAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSlcbiAgICBpZiAoaXNGb290ZXIpIHtcbiAgICAgIHNoZWV0LmFkZFJvd3MoZm9vdExpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xuICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KVxuICAgICAgICB9XG4gICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XG4gICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbClcbiAgICAgICAgICBjb25zdCBjb2x1bW46IGFueSA9ICR0YWJsZS5nZXRDb2x1bW5CeUlkKGV4Y2VsQ29sLmtleSBhcyBzdHJpbmcpXG4gICAgICAgICAgY29uc3QgeyBmb290ZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtblxuICAgICAgICAgIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgZm9vdGVyQWxpZ24gfHwgYWxpZ24gfHwgYWxsRm9vdGVyQWxpZ24gfHwgYWxsQWxpZ24pXG4gICAgICAgICAgaWYgKHVzZVN0eWxlKSB7XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xuICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfVxuICAgIGlmICh1c2VTdHlsZSAmJiBzaGVldE1ldGhvZCkge1xuICAgICAgc2hlZXRNZXRob2QoeyBvcHRpb25zOiBvcHRpb25zLCB3b3JrYm9vaywgd29ya3NoZWV0OiBzaGVldCwgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcywgJHRhYmxlIH0pXG4gICAgfVxuICAgIHNoZWV0TWVyZ2VzLmZvckVhY2goKHsgcywgZSB9KSA9PiB7XG4gICAgICBzaGVldC5tZXJnZUNlbGxzKHMuciArIDEsIHMuYyArIDEsIGUuciArIDEsIGUuYyArIDEpXG4gICAgfSlcbiAgICB3b3JrYm9vay54bHN4LndyaXRlQnVmZmVyKCkudGhlbihidWZmZXIgPT4ge1xuICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbYnVmZmVyXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyB9KVxuICAgICAgLy8g5a+85Ye6IHhsc3hcbiAgICAgIGRvd25sb2FkRmlsZShwYXJhbXMsIGJsb2IsIG9wdGlvbnMpXG4gICAgICBpZiAoc2hvd01zZykge1xuICAgICAgICB2eGV0YWJsZS5tb2RhbC5jbG9zZShtc2dLZXkpXG4gICAgICAgIHZ4ZXRhYmxlLm1vZGFsLm1lc3NhZ2UoeyBtZXNzYWdlOiB2eGV0YWJsZS50KCd2eGUudGFibGUuZXhwU3VjY2VzcycpLCBzdGF0dXM6ICdzdWNjZXNzJyB9KVxuICAgICAgfVxuICAgIH0pXG4gIH1cbiAgaWYgKHNob3dNc2cpIHtcbiAgICB2eGV0YWJsZS5tb2RhbC5tZXNzYWdlKHsgaWQ6IG1zZ0tleSwgbWVzc2FnZTogdnhldGFibGUudCgndnhlLnRhYmxlLmV4cExvYWRpbmcnKSwgc3RhdHVzOiAnbG9hZGluZycsIGR1cmF0aW9uOiAtMSB9KVxuICAgIHNldFRpbWVvdXQoZXhwb3J0TWV0aG9kLCAxNTAwKVxuICB9IGVsc2Uge1xuICAgIGV4cG9ydE1ldGhvZCgpXG4gIH1cbn1cblxuZnVuY3Rpb24gZG93bmxvYWRGaWxlIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckV4cG9ydFBhcmFtcywgYmxvYjogQmxvYiwgb3B0aW9uczogVnhlVGFibGVQcm9wVHlwZXMuRXhwb3J0Q29uZmlnKSB7XG4gIGNvbnN0IHsgbWVzc2FnZSwgZmlsZW5hbWUsIHR5cGUgfSA9IG9wdGlvbnNcbiAgY29uc3Qgc2hvd01zZyA9IG1lc3NhZ2UgIT09IGZhbHNlXG4gIGlmICh3aW5kb3cuQmxvYikge1xuICAgIGNvbnN0IGxpbmtFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpXG4gICAgbGlua0VsZW0udGFyZ2V0ID0gJ19ibGFuaydcbiAgICBsaW5rRWxlbS5kb3dubG9hZCA9IGAke2ZpbGVuYW1lfS4ke3R5cGV9YFxuICAgIGxpbmtFbGVtLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rRWxlbSlcbiAgICBsaW5rRWxlbS5jbGljaygpXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rRWxlbSlcbiAgfSBlbHNlIHtcbiAgICBpZiAoc2hvd01zZykge1xuICAgICAgdnhldGFibGUubW9kYWwuYWxlcnQoeyBtZXNzYWdlOiB2eGV0YWJsZS50KCd2eGUuZXJyb3Iubm90RXhwJyksIHN0YXR1czogJ2Vycm9yJyB9KVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBjaGVja0ltcG9ydERhdGEgKHRhYmxlRmllbGRzOiBzdHJpbmdbXSwgZmllbGRzOiBzdHJpbmdbXSkge1xuICByZXR1cm4gZmllbGRzLnNvbWUoZmllbGQgPT4gdGFibGVGaWVsZHMuaW5kZXhPZihmaWVsZCkgPiAtMSlcbn1cblxuZnVuY3Rpb24gaW1wb3J0RXJyb3IgKHBhcmFtczogVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzLkludGVyY2VwdG9ySW1wb3J0UGFyYW1zKSB7XG4gIGNvbnN0IHsgJHRhYmxlLCBvcHRpb25zIH0gPSBwYXJhbXNcbiAgY29uc3QgeyBpbnRlcm5hbERhdGEgfSA9ICR0YWJsZVxuICBjb25zdCB7IF9pbXBvcnRSZWplY3QgfSA9IGludGVybmFsRGF0YVxuICBjb25zdCBzaG93TXNnID0gb3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZVxuICBpZiAoc2hvd01zZykge1xuICAgIHZ4ZXRhYmxlLm1vZGFsLm1lc3NhZ2UoeyBtZXNzYWdlOiB2eGV0YWJsZS50KCd2eGUuZXJyb3IuaW1wRmllbGRzJyksIHN0YXR1czogJ2Vycm9yJyB9KVxuICB9XG4gIGlmIChfaW1wb3J0UmVqZWN0KSB7XG4gICAgX2ltcG9ydFJlamVjdCh7IHN0YXR1czogZmFsc2UgfSlcbiAgfVxufVxuXG5mdW5jdGlvbiBpbXBvcnRYTFNYIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckltcG9ydFBhcmFtcykge1xuICBjb25zdCB7ICR0YWJsZSwgY29sdW1ucywgb3B0aW9ucywgZmlsZSB9ID0gcGFyYW1zXG4gIGNvbnN0IHsgaW50ZXJuYWxEYXRhIH0gPSAkdGFibGVcbiAgY29uc3QgeyBfaW1wb3J0UmVzb2x2ZSB9ID0gaW50ZXJuYWxEYXRhXG4gIGNvbnN0IHNob3dNc2cgPSBvcHRpb25zLm1lc3NhZ2UgIT09IGZhbHNlXG4gIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gIGZpbGVSZWFkZXIub25lcnJvciA9ICgpID0+IHtcbiAgICBpbXBvcnRFcnJvcihwYXJhbXMpXG4gIH1cbiAgZmlsZVJlYWRlci5vbmxvYWQgPSAoZXZudCkgPT4ge1xuICAgIGNvbnN0IHRhYmxlRmllbGRzOiBzdHJpbmdbXSA9IFtdXG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgIGNvbnN0IGZpZWxkID0gY29sdW1uLnByb3BlcnR5XG4gICAgICBpZiAoZmllbGQpIHtcbiAgICAgICAgdGFibGVGaWVsZHMucHVzaChmaWVsZClcbiAgICAgIH1cbiAgICB9KVxuICAgIGNvbnN0IHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKVxuICAgIGNvbnN0IHJlYWRlclRhcmdldCA9IGV2bnQudGFyZ2V0XG4gICAgaWYgKHJlYWRlclRhcmdldCkge1xuICAgICAgd29ya2Jvb2sueGxzeC5sb2FkKHJlYWRlclRhcmdldC5yZXN1bHQgYXMgQXJyYXlCdWZmZXIpLnRoZW4od2IgPT4ge1xuICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd2Iud29ya3NoZWV0c1swXVxuICAgICAgICBpZiAoZmlyc3RTaGVldCkge1xuICAgICAgICAgIGNvbnN0IHNoZWV0VmFsdWVzID0gZmlyc3RTaGVldC5nZXRTaGVldFZhbHVlcygpIGFzIHN0cmluZ1tdW11cbiAgICAgICAgICBjb25zdCBmaWVsZEluZGV4ID0gWEVVdGlscy5maW5kSW5kZXhPZihzaGVldFZhbHVlcywgKGxpc3Q6IHN0cmluZ1tdKSA9PiBsaXN0ICYmIGxpc3QubGVuZ3RoID4gMClcbiAgICAgICAgICBjb25zdCBmaWVsZHMgPSBzaGVldFZhbHVlc1tmaWVsZEluZGV4XSBhcyBzdHJpbmdbXVxuICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGNoZWNrSW1wb3J0RGF0YSh0YWJsZUZpZWxkcywgZmllbGRzKVxuICAgICAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSBzaGVldFZhbHVlcy5zbGljZShmaWVsZEluZGV4KS5tYXAobGlzdCA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGl0ZW0gOiBhbnkgPSB7fVxuICAgICAgICAgICAgICBsaXN0LmZvckVhY2goKGNlbGxWYWx1ZSwgY0luZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgaXRlbVtmaWVsZHNbY0luZGV4XV0gPSBjZWxsVmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgY29uc3QgcmVjb3JkOiBhbnkgPSB7fVxuICAgICAgICAgICAgICB0YWJsZUZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgICAgICAgICByZWNvcmRbZmllbGRdID0gWEVVdGlscy5pc1VuZGVmaW5lZChpdGVtW2ZpZWxkXSkgPyBudWxsIDogaXRlbVtmaWVsZF1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICR0YWJsZS5jcmVhdGVEYXRhKHJlY29yZHMpXG4gICAgICAgICAgICAgIC50aGVuKChkYXRhOiBhbnlbXSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBsb2FkUmVzdDogUHJvbWlzZTxhbnk+XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubW9kZSA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgICAgICAgICAgIGxvYWRSZXN0ID0gJHRhYmxlLmluc2VydEF0KGRhdGEsIC0xKVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBsb2FkUmVzdCA9ICR0YWJsZS5yZWxvYWREYXRhKGRhdGEpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBsb2FkUmVzdC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChfaW1wb3J0UmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICAgICBfaW1wb3J0UmVzb2x2ZSh7IHN0YXR1czogdHJ1ZSB9KVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBpZiAoc2hvd01zZykge1xuICAgICAgICAgICAgICB2eGV0YWJsZS5tb2RhbC5tZXNzYWdlKHsgbWVzc2FnZTogdnhldGFibGUudCgndnhlLnRhYmxlLmltcFN1Y2Nlc3MnLCBbcmVjb3Jkcy5sZW5ndGhdKSwgc3RhdHVzOiAnc3VjY2VzcycgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGltcG9ydEVycm9yKHBhcmFtcylcbiAgICB9XG4gIH1cbiAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKVxufVxuXG5mdW5jdGlvbiBoYW5kbGVJbXBvcnRFdmVudCAocGFyYW1zOiBWeGVHbG9iYWxJbnRlcmNlcHRvckhhbmRsZXMuSW50ZXJjZXB0b3JJbXBvcnRQYXJhbXMpIHtcbiAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICd4bHN4Jykge1xuICAgIGltcG9ydFhMU1gocGFyYW1zKVxuICAgIHJldHVybiBmYWxzZVxuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUV4cG9ydEV2ZW50IChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckV4cG9ydFBhcmFtcykge1xuICBpZiAocGFyYW1zLm9wdGlvbnMudHlwZSA9PT0gJ3hsc3gnKSB7XG4gICAgZXhwb3J0WExTWChwYXJhbXMpXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbn1cblxuLyoqXG4gKiDln7rkuo4gdnhlLXRhYmxlIOihqOagvOeahOWinuW8uuaPkuS7tu+8jOaUr+aMgeWvvOWHuiB4bHN4IOagvOW8j1xuICovXG5leHBvcnQgY29uc3QgVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYID0ge1xuICBpbnN0YWxsICh2eGV0YWJsZWNvcmU6IFZYRVRhYmxlQ29yZSkge1xuICAgIGNvbnN0IHsgc2V0dXAsIGludGVyY2VwdG9yIH0gPSB2eGV0YWJsZWNvcmVcblxuICAgIHZ4ZXRhYmxlID0gdnhldGFibGVjb3JlXG5cbiAgICBzZXR1cCh7XG4gICAgICBleHBvcnQ6IHtcbiAgICAgICAgdHlwZXM6IHtcbiAgICAgICAgICB4bHN4OiAwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIGludGVyY2VwdG9yLm1peGluKHtcbiAgICAgICdldmVudC5pbXBvcnQnOiBoYW5kbGVJbXBvcnRFdmVudCxcbiAgICAgICdldmVudC5leHBvcnQnOiBoYW5kbGVFeHBvcnRFdmVudFxuICAgIH0pXG4gIH1cbn1cblxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WWEVUYWJsZSkge1xuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWClcbn1cblxuZXhwb3J0IGRlZmF1bHQgVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYXG4iLCJpbXBvcnQgWEVVdGlscyBmcm9tICd4ZS11dGlscyc7XG5pbXBvcnQgRXhjZWxKUyBmcm9tICdleGNlbGpzJztcbmxldCB2eGV0YWJsZTtcbmNvbnN0IGRlZmF1bHRIZWFkZXJCYWNrZ3JvdW5kQ29sb3IgPSAnZjhmOGY5JztcbmNvbnN0IGRlZmF1bHRDZWxsRm9udENvbG9yID0gJzYwNjI2Nic7XG5jb25zdCBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlID0gJ3RoaW4nO1xuY29uc3QgZGVmYXVsdENlbGxCb3JkZXJDb2xvciA9ICdlOGVhZWMnO1xuZnVuY3Rpb24gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgY2VsbFZhbHVlKSB7XG4gICAgaWYgKGNlbGxWYWx1ZSkge1xuICAgICAgICBzd2l0Y2ggKGNvbHVtbi5jZWxsVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gWEVVdGlscy50b1ZhbHVlU3RyaW5nKGNlbGxWYWx1ZSk7XG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGlmICghaXNOYU4oY2VsbFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKGNlbGxWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoY2VsbFZhbHVlLmxlbmd0aCA8IDEyICYmICFpc05hTihjZWxsVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIoY2VsbFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNlbGxWYWx1ZTtcbn1cbmZ1bmN0aW9uIGdldEZvb3RlckRhdGEob3B0cywgZm9vdGVyRGF0YSkge1xuICAgIGNvbnN0IHsgZm9vdGVyRmlsdGVyTWV0aG9kIH0gPSBvcHRzO1xuICAgIHJldHVybiBmb290ZXJGaWx0ZXJNZXRob2QgPyBmb290ZXJEYXRhLmZpbHRlcigoaXRlbXMsIGluZGV4KSA9PiBmb290ZXJGaWx0ZXJNZXRob2QoeyBpdGVtcywgJHJvd0luZGV4OiBpbmRleCB9KSkgOiBmb290ZXJEYXRhO1xufVxuZnVuY3Rpb24gZ2V0Rm9vdGVyQ2VsbFZhbHVlKCR0YWJsZSwgb3B0cywgcm93cywgY29sdW1uKSB7XG4gICAgY29uc3QgY2VsbFZhbHVlID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgcm93c1skdGFibGUuZ2V0Vk1Db2x1bW5JbmRleChjb2x1bW4pXSk7XG4gICAgcmV0dXJuIGNlbGxWYWx1ZTtcbn1cbmZ1bmN0aW9uIGdldFZhbGlkQ29sdW1uKGNvbHVtbikge1xuICAgIGNvbnN0IHsgY2hpbGROb2RlcyB9ID0gY29sdW1uO1xuICAgIGNvbnN0IGlzQ29sR3JvdXAgPSBjaGlsZE5vZGVzICYmIGNoaWxkTm9kZXMubGVuZ3RoO1xuICAgIGlmIChpc0NvbEdyb3VwKSB7XG4gICAgICAgIHJldHVybiBnZXRWYWxpZENvbHVtbihjaGlsZE5vZGVzWzBdKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbHVtbjtcbn1cbmZ1bmN0aW9uIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCBoZWlnaHQpIHtcbiAgICBpZiAoaGVpZ2h0KSB7XG4gICAgICAgIGV4Y2VsUm93LmhlaWdodCA9IFhFVXRpbHMuZmxvb3IoaGVpZ2h0ICogMC43NSwgMTIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgYWxpZ24pIHtcbiAgICBleGNlbENlbGwucHJvdGVjdGlvbiA9IHtcbiAgICAgICAgbG9ja2VkOiBmYWxzZVxuICAgIH07XG4gICAgZXhjZWxDZWxsLmFsaWdubWVudCA9IHtcbiAgICAgICAgdmVydGljYWw6ICdtaWRkbGUnLFxuICAgICAgICBob3Jpem9udGFsOiBhbGlnbiB8fCAnbGVmdCdcbiAgICB9O1xufVxuZnVuY3Rpb24gZ2V0RGVmYXVsdEJvcmRlclN0eWxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbGVmdDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYm90dG9tOiB7XG4gICAgICAgICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcbiAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByaWdodDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59XG5mdW5jdGlvbiBleHBvcnRYTFNYKHBhcmFtcykge1xuICAgIGNvbnN0IG1zZ0tleSA9ICd4bHN4JztcbiAgICBjb25zdCB7ICR0YWJsZSwgb3B0aW9ucywgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcyB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHsgcHJvcHMsIHJlYWN0RGF0YSB9ID0gJHRhYmxlO1xuICAgIGNvbnN0IHsgaGVhZGVyQWxpZ246IGFsbEhlYWRlckFsaWduLCBhbGlnbjogYWxsQWxpZ24sIGZvb3RlckFsaWduOiBhbGxGb290ZXJBbGlnbiB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyByb3dIZWlnaHQgfSA9IHJlYWN0RGF0YTtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIHNoZWV0TmFtZSwgaXNIZWFkZXIsIGlzRm9vdGVyLCBpc01lcmdlLCBpc0NvbGdyb3VwLCBvcmlnaW5hbCwgdXNlU3R5bGUsIHNoZWV0TWV0aG9kIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IHNob3dNc2cgPSBtZXNzYWdlICE9PSBmYWxzZTtcbiAgICBjb25zdCBtZXJnZUNlbGxzID0gJHRhYmxlLmdldE1lcmdlQ2VsbHMoKTtcbiAgICBjb25zdCBjb2xMaXN0ID0gW107XG4gICAgY29uc3QgZm9vdExpc3QgPSBbXTtcbiAgICBjb25zdCBzaGVldENvbHMgPSBbXTtcbiAgICBjb25zdCBzaGVldE1lcmdlcyA9IFtdO1xuICAgIGxldCBiZWZvcmVSb3dDb3VudCA9IDA7XG4gICAgY29uc3QgY29sSGVhZCA9IHt9O1xuICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaWQsIHByb3BlcnR5LCByZW5kZXJXaWR0aCB9ID0gY29sdW1uO1xuICAgICAgICBjb2xIZWFkW2lkXSA9IG9yaWdpbmFsID8gcHJvcGVydHkgOiBjb2x1bW4uZ2V0VGl0bGUoKTtcbiAgICAgICAgc2hlZXRDb2xzLnB1c2goe1xuICAgICAgICAgICAga2V5OiBpZCxcbiAgICAgICAgICAgIHdpZHRoOiBYRVV0aWxzLmNlaWwocmVuZGVyV2lkdGggLyA4LCAxKVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyDlpITnkIbooajlpLRcbiAgICBpZiAoaXNIZWFkZXIpIHtcbiAgICAgICAgLy8g5aSE55CG5YiG57uEXG4gICAgICAgIGlmIChpc0NvbGdyb3VwICYmICFvcmlnaW5hbCAmJiBjb2xncm91cHMpIHtcbiAgICAgICAgICAgIGNvbGdyb3Vwcy5mb3JFYWNoKChjb2xzLCBySW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cEhlYWQgPSB7fTtcbiAgICAgICAgICAgICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBncm91cEhlYWRbY29sdW1uLmlkXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29scy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBfY29sU3BhbiwgX3Jvd1NwYW4gfSA9IGNvbHVtbjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRDb2x1bW4gPSBnZXRWYWxpZENvbHVtbihjb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW5JbmRleCA9IGNvbHVtbnMuaW5kZXhPZih2YWxpZENvbHVtbik7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwSGVhZFt2YWxpZENvbHVtbi5pZF0gPSBvcmlnaW5hbCA/IHZhbGlkQ29sdW1uLnByb3BlcnR5IDogY29sdW1uLmdldFRpdGxlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfY29sU3BhbiA+IDEgfHwgX3Jvd1NwYW4gPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaGVldE1lcmdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiB7IHI6IHJJbmRleCwgYzogY29sdW1uSW5kZXggfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlOiB7IHI6IHJJbmRleCArIF9yb3dTcGFuIC0gMSwgYzogY29sdW1uSW5kZXggKyBfY29sU3BhbiAtIDEgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb2xMaXN0LnB1c2goZ3JvdXBIZWFkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29sTGlzdC5wdXNoKGNvbEhlYWQpO1xuICAgICAgICB9XG4gICAgICAgIGJlZm9yZVJvd0NvdW50ICs9IGNvbExpc3QubGVuZ3RoO1xuICAgIH1cbiAgICAvLyDlpITnkIblkIjlubZcbiAgICBpZiAoaXNNZXJnZSAmJiAhb3JpZ2luYWwpIHtcbiAgICAgICAgbWVyZ2VDZWxscy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHJvdzogbWVyZ2VSb3dJbmRleCwgcm93c3BhbjogbWVyZ2VSb3dzcGFuLCBjb2w6IG1lcmdlQ29sSW5kZXgsIGNvbHNwYW46IG1lcmdlQ29sc3BhbiB9ID0gbWVyZ2VJdGVtO1xuICAgICAgICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcbiAgICAgICAgICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgcm93TGlzdCA9IGRhdGFzLm1hcChpdGVtID0+IHtcbiAgICAgICAgY29uc3QgcmVzdCA9IHt9O1xuICAgICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgcmVzdFtjb2x1bW4uaWRdID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgaXRlbVtjb2x1bW4uaWRdKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN0O1xuICAgIH0pO1xuICAgIGJlZm9yZVJvd0NvdW50ICs9IHJvd0xpc3QubGVuZ3RoO1xuICAgIC8vIOWkhOeQhuihqOWwvlxuICAgIGlmIChpc0Zvb3Rlcikge1xuICAgICAgICBjb25zdCB7IGZvb3RlckRhdGEgfSA9ICR0YWJsZS5nZXRUYWJsZURhdGEoKTtcbiAgICAgICAgY29uc3QgZm9vdGVycyA9IGdldEZvb3RlckRhdGEob3B0aW9ucywgZm9vdGVyRGF0YSk7XG4gICAgICAgIGNvbnN0IG1lcmdlRm9vdGVySXRlbXMgPSAkdGFibGUuZ2V0TWVyZ2VGb290ZXJJdGVtcygpO1xuICAgICAgICAvLyDlpITnkIblkIjlubZcbiAgICAgICAgaWYgKGlzTWVyZ2UgJiYgIW9yaWdpbmFsKSB7XG4gICAgICAgICAgICBtZXJnZUZvb3Rlckl0ZW1zLmZvckVhY2gobWVyZ2VJdGVtID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHJvdzogbWVyZ2VSb3dJbmRleCwgcm93c3BhbjogbWVyZ2VSb3dzcGFuLCBjb2w6IG1lcmdlQ29sSW5kZXgsIGNvbHNwYW46IG1lcmdlQ29sc3BhbiB9ID0gbWVyZ2VJdGVtO1xuICAgICAgICAgICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCwgYzogbWVyZ2VDb2xJbmRleCB9LFxuICAgICAgICAgICAgICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZvb3RlcnMuZm9yRWFjaCgocm93cykgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHt9O1xuICAgICAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgICAgICBpdGVtW2NvbHVtbi5pZF0gPSBnZXRGb290ZXJDZWxsVmFsdWUoJHRhYmxlLCBvcHRpb25zLCByb3dzLCBjb2x1bW4pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb290TGlzdC5wdXNoKGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZXhwb3J0TWV0aG9kID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB3b3JrYm9vayA9IG5ldyBFeGNlbEpTLldvcmtib29rKCk7XG4gICAgICAgIGNvbnN0IHNoZWV0ID0gd29ya2Jvb2suYWRkV29ya3NoZWV0KHNoZWV0TmFtZSk7XG4gICAgICAgIHdvcmtib29rLmNyZWF0b3IgPSAndnhlLXRhYmxlJztcbiAgICAgICAgc2hlZXQuY29sdW1ucyA9IHNoZWV0Q29scztcbiAgICAgICAgaWYgKGlzSGVhZGVyKSB7XG4gICAgICAgICAgICBzaGVldC5hZGRSb3dzKGNvbExpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXhjZWxSb3cuZWFjaENlbGwoZXhjZWxDZWxsID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUlkKGV4Y2VsQ29sLmtleSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgaGVhZGVyQWxpZ24sIGFsaWduIH0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgaGVhZGVyQWxpZ24gfHwgYWxpZ24gfHwgYWxsSGVhZGVyQWxpZ24gfHwgYWxsQWxpZ24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXhjZWxDZWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxGb250Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGF0dGVybicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46ICdzb2xpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZnQ29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRIZWFkZXJCYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHNoZWV0LmFkZFJvd3Mocm93TGlzdCkuZm9yRWFjaChleGNlbFJvdyA9PiB7XG4gICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5SWQoZXhjZWxDb2wua2V5KTtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGFsaWduIH0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBhbGlnbiB8fCBhbGxBbGlnbik7XG4gICAgICAgICAgICAgICAgaWYgKHVzZVN0eWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXhjZWxDZWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxGb250Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpc0Zvb3Rlcikge1xuICAgICAgICAgICAgc2hlZXQuYWRkUm93cyhmb290TGlzdCkuZm9yRWFjaChleGNlbFJvdyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZVN0eWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBleGNlbFJvdy5lYWNoQ2VsbChleGNlbENlbGwgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5SWQoZXhjZWxDb2wua2V5KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBmb290ZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtbjtcbiAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBmb290ZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxGb290ZXJBbGlnbiB8fCBhbGxBbGlnbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihleGNlbENlbGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZVN0eWxlICYmIHNoZWV0TWV0aG9kKSB7XG4gICAgICAgICAgICBzaGVldE1ldGhvZCh7IG9wdGlvbnM6IG9wdGlvbnMsIHdvcmtib29rLCB3b3Jrc2hlZXQ6IHNoZWV0LCBjb2x1bW5zLCBjb2xncm91cHMsIGRhdGFzLCAkdGFibGUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgc2hlZXRNZXJnZXMuZm9yRWFjaCgoeyBzLCBlIH0pID0+IHtcbiAgICAgICAgICAgIHNoZWV0Lm1lcmdlQ2VsbHMocy5yICsgMSwgcy5jICsgMSwgZS5yICsgMSwgZS5jICsgMSk7XG4gICAgICAgIH0pO1xuICAgICAgICB3b3JrYm9vay54bHN4LndyaXRlQnVmZmVyKCkudGhlbihidWZmZXIgPT4ge1xuICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbYnVmZmVyXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyB9KTtcbiAgICAgICAgICAgIC8vIOWvvOWHuiB4bHN4XG4gICAgICAgICAgICBkb3dubG9hZEZpbGUocGFyYW1zLCBibG9iLCBvcHRpb25zKTtcbiAgICAgICAgICAgIGlmIChzaG93TXNnKSB7XG4gICAgICAgICAgICAgICAgdnhldGFibGUubW9kYWwuY2xvc2UobXNnS2V5KTtcbiAgICAgICAgICAgICAgICB2eGV0YWJsZS5tb2RhbC5tZXNzYWdlKHsgbWVzc2FnZTogdnhldGFibGUudCgndnhlLnRhYmxlLmV4cFN1Y2Nlc3MnKSwgc3RhdHVzOiAnc3VjY2VzcycgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgaWYgKHNob3dNc2cpIHtcbiAgICAgICAgdnhldGFibGUubW9kYWwubWVzc2FnZSh7IGlkOiBtc2dLZXksIG1lc3NhZ2U6IHZ4ZXRhYmxlLnQoJ3Z4ZS50YWJsZS5leHBMb2FkaW5nJyksIHN0YXR1czogJ2xvYWRpbmcnLCBkdXJhdGlvbjogLTEgfSk7XG4gICAgICAgIHNldFRpbWVvdXQoZXhwb3J0TWV0aG9kLCAxNTAwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydE1ldGhvZCgpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRvd25sb2FkRmlsZShwYXJhbXMsIGJsb2IsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIGZpbGVuYW1lLCB0eXBlIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IHNob3dNc2cgPSBtZXNzYWdlICE9PSBmYWxzZTtcbiAgICBpZiAod2luZG93LkJsb2IpIHtcbiAgICAgICAgY29uc3QgbGlua0VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgIGxpbmtFbGVtLnRhcmdldCA9ICdfYmxhbmsnO1xuICAgICAgICBsaW5rRWxlbS5kb3dubG9hZCA9IGAke2ZpbGVuYW1lfS4ke3R5cGV9YDtcbiAgICAgICAgbGlua0VsZW0uaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGlua0VsZW0pO1xuICAgICAgICBsaW5rRWxlbS5jbGljaygpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmtFbGVtKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChzaG93TXNnKSB7XG4gICAgICAgICAgICB2eGV0YWJsZS5tb2RhbC5hbGVydCh7IG1lc3NhZ2U6IHZ4ZXRhYmxlLnQoJ3Z4ZS5lcnJvci5ub3RFeHAnKSwgc3RhdHVzOiAnZXJyb3InIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gY2hlY2tJbXBvcnREYXRhKHRhYmxlRmllbGRzLCBmaWVsZHMpIHtcbiAgICByZXR1cm4gZmllbGRzLnNvbWUoZmllbGQgPT4gdGFibGVGaWVsZHMuaW5kZXhPZihmaWVsZCkgPiAtMSk7XG59XG5mdW5jdGlvbiBpbXBvcnRFcnJvcihwYXJhbXMpIHtcbiAgICBjb25zdCB7ICR0YWJsZSwgb3B0aW9ucyB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHsgaW50ZXJuYWxEYXRhIH0gPSAkdGFibGU7XG4gICAgY29uc3QgeyBfaW1wb3J0UmVqZWN0IH0gPSBpbnRlcm5hbERhdGE7XG4gICAgY29uc3Qgc2hvd01zZyA9IG9wdGlvbnMubWVzc2FnZSAhPT0gZmFsc2U7XG4gICAgaWYgKHNob3dNc2cpIHtcbiAgICAgICAgdnhldGFibGUubW9kYWwubWVzc2FnZSh7IG1lc3NhZ2U6IHZ4ZXRhYmxlLnQoJ3Z4ZS5lcnJvci5pbXBGaWVsZHMnKSwgc3RhdHVzOiAnZXJyb3InIH0pO1xuICAgIH1cbiAgICBpZiAoX2ltcG9ydFJlamVjdCkge1xuICAgICAgICBfaW1wb3J0UmVqZWN0KHsgc3RhdHVzOiBmYWxzZSB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBpbXBvcnRYTFNYKHBhcmFtcykge1xuICAgIGNvbnN0IHsgJHRhYmxlLCBjb2x1bW5zLCBvcHRpb25zLCBmaWxlIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgeyBpbnRlcm5hbERhdGEgfSA9ICR0YWJsZTtcbiAgICBjb25zdCB7IF9pbXBvcnRSZXNvbHZlIH0gPSBpbnRlcm5hbERhdGE7XG4gICAgY29uc3Qgc2hvd01zZyA9IG9wdGlvbnMubWVzc2FnZSAhPT0gZmFsc2U7XG4gICAgY29uc3QgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgZmlsZVJlYWRlci5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpO1xuICAgIH07XG4gICAgZmlsZVJlYWRlci5vbmxvYWQgPSAoZXZudCkgPT4ge1xuICAgICAgICBjb25zdCB0YWJsZUZpZWxkcyA9IFtdO1xuICAgICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmllbGQgPSBjb2x1bW4ucHJvcGVydHk7XG4gICAgICAgICAgICBpZiAoZmllbGQpIHtcbiAgICAgICAgICAgICAgICB0YWJsZUZpZWxkcy5wdXNoKGZpZWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKTtcbiAgICAgICAgY29uc3QgcmVhZGVyVGFyZ2V0ID0gZXZudC50YXJnZXQ7XG4gICAgICAgIGlmIChyZWFkZXJUYXJnZXQpIHtcbiAgICAgICAgICAgIHdvcmtib29rLnhsc3gubG9hZChyZWFkZXJUYXJnZXQucmVzdWx0KS50aGVuKHdiID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFNoZWV0ID0gd2Iud29ya3NoZWV0c1swXTtcbiAgICAgICAgICAgICAgICBpZiAoZmlyc3RTaGVldCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGVldFZhbHVlcyA9IGZpcnN0U2hlZXQuZ2V0U2hlZXRWYWx1ZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRJbmRleCA9IFhFVXRpbHMuZmluZEluZGV4T2Yoc2hlZXRWYWx1ZXMsIChsaXN0KSA9PiBsaXN0ICYmIGxpc3QubGVuZ3RoID4gMCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IHNoZWV0VmFsdWVzW2ZpZWxkSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBjaGVja0ltcG9ydERhdGEodGFibGVGaWVsZHMsIGZpZWxkcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSBzaGVldFZhbHVlcy5zbGljZShmaWVsZEluZGV4KS5tYXAobGlzdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuZm9yRWFjaCgoY2VsbFZhbHVlLCBjSW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtmaWVsZHNbY0luZGV4XV0gPSBjZWxsVmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVGaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZFtmaWVsZF0gPSBYRVV0aWxzLmlzVW5kZWZpbmVkKGl0ZW1bZmllbGRdKSA/IG51bGwgOiBpdGVtW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGFibGUuY3JlYXRlRGF0YShyZWNvcmRzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxvYWRSZXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGUgPT09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSZXN0ID0gJHRhYmxlLmluc2VydEF0KGRhdGEsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSZXN0ID0gJHRhYmxlLnJlbG9hZERhdGEoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsb2FkUmVzdC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9pbXBvcnRSZXNvbHZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaW1wb3J0UmVzb2x2ZSh7IHN0YXR1czogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd01zZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZ4ZXRhYmxlLm1vZGFsLm1lc3NhZ2UoeyBtZXNzYWdlOiB2eGV0YWJsZS50KCd2eGUudGFibGUuaW1wU3VjY2VzcycsIFtyZWNvcmRzLmxlbmd0aF0pLCBzdGF0dXM6ICdzdWNjZXNzJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydEVycm9yKHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltcG9ydEVycm9yKHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpO1xufVxuZnVuY3Rpb24gaGFuZGxlSW1wb3J0RXZlbnQocGFyYW1zKSB7XG4gICAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICd4bHN4Jykge1xuICAgICAgICBpbXBvcnRYTFNYKHBhcmFtcyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5mdW5jdGlvbiBoYW5kbGVFeHBvcnRFdmVudChwYXJhbXMpIHtcbiAgICBpZiAocGFyYW1zLm9wdGlvbnMudHlwZSA9PT0gJ3hsc3gnKSB7XG4gICAgICAgIGV4cG9ydFhMU1gocGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbi8qKlxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlop7lvLrmj5Lku7bvvIzmlK/mjIHlr7zlh7ogeGxzeCDmoLzlvI9cbiAqL1xuZXhwb3J0IGNvbnN0IFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWCA9IHtcbiAgICBpbnN0YWxsKHZ4ZXRhYmxlY29yZSkge1xuICAgICAgICBjb25zdCB7IHNldHVwLCBpbnRlcmNlcHRvciB9ID0gdnhldGFibGVjb3JlO1xuICAgICAgICB2eGV0YWJsZSA9IHZ4ZXRhYmxlY29yZTtcbiAgICAgICAgc2V0dXAoe1xuICAgICAgICAgICAgZXhwb3J0OiB7XG4gICAgICAgICAgICAgICAgdHlwZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgeGxzeDogMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGludGVyY2VwdG9yLm1peGluKHtcbiAgICAgICAgICAgICdldmVudC5pbXBvcnQnOiBoYW5kbGVJbXBvcnRFdmVudCxcbiAgICAgICAgICAgICdldmVudC5leHBvcnQnOiBoYW5kbGVFeHBvcnRFdmVudFxuICAgICAgICB9KTtcbiAgICB9XG59O1xuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WWEVUYWJsZSkge1xuICAgIHdpbmRvdy5WWEVUYWJsZS51c2UoVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYKTtcbn1cbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWDtcbiJdfQ==
