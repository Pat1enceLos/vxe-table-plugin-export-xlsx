"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginExport = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils/methods/xe-utils"));

var XLSX = _interopRequireWildcard(require("xlsx"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; if (obj != null) { var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function toBuffer(wbout) {
  var buf = new ArrayBuffer(wbout.length);
  var view = new Uint8Array(buf);

  for (var index = 0; index !== wbout.length; ++index) {
    view[index] = wbout.charCodeAt(index) & 0xFF;
  }

  return buf;
}

function exportXLSX(params) {
  var $table = params.$table,
      options = params.options,
      columns = params.columns,
      datas = params.datas;
  var sheetName = options.sheetName,
      type = options.type,
      isHeader = options.isHeader,
      isFooter = options.isFooter,
      original = options.original,
      message = options.message,
      footerFilterMethod = options.footerFilterMethod;
  var colHead = {};
  var footList = [];

  if (isHeader) {
    columns.forEach(function (column) {
      colHead[column.id] = (original ? column.property : column.getTitle()) || '';
    });
  }

  var rowList = datas.map(function (row) {
    var item = {};
    columns.forEach(function (column) {
      item[column.id] = original ? _xeUtils["default"].get(row, column.property) : row[column.id];
    });
    return item;
  });

  if (isFooter) {
    var footerData = $table.footerData;
    var footers = footerFilterMethod ? footerData.filter(footerFilterMethod) : footerData;
    footers.forEach(function (rows) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = rows[$table.getColumnIndex(column)] || '';
      });
      footList.push(item);
    });
  }

  var book = XLSX.utils.book_new();
  var sheet = XLSX.utils.json_to_sheet((isHeader ? [colHead] : []).concat(rowList).concat(footList), {
    skipHeader: true
  }); // 转换数据

  XLSX.utils.book_append_sheet(book, sheet, sheetName);
  var wbout = XLSX.write(book, {
    bookType: type,
    bookSST: false,
    type: 'binary'
  });
  var blob = new Blob([toBuffer(wbout)], {
    type: 'application/octet-stream'
  }); // 保存导出

  downloadFile(blob, options);

  if (message !== false) {
    $table.$XModal.message({
      message: i18n('vxe.table.expSuccess'),
      status: 'success'
    });
  }
}

function downloadFile(blob, options) {
  if (window.Blob) {
    var filename = options.filename,
        type = options.type;

    if (navigator.msSaveBlob) {
      navigator.msSaveBlob(blob, filename);
    } else {
      var linkElem = document.createElement('a');
      linkElem.target = '_blank';
      linkElem.download = "".concat(filename, ".").concat(type);
      linkElem.href = URL.createObjectURL(blob);
      document.body.appendChild(linkElem);
      linkElem.click();
      document.body.removeChild(linkElem);
    }
  } else {
    console.error(i18n('vxe.error.notExp'));
  }
}

function replaceDoubleQuotation(val) {
  return val.replace(/^"/, '').replace(/"$/, '');
}

function parseCsv(columns, content) {
  var list = content.split('\n');
  var fields = [];
  var rows = [];

  if (list.length) {
    var rList = list.slice(1);
    list[0].split(',').forEach(function (val) {
      var field = replaceDoubleQuotation(val);

      if (field) {
        fields.push(field);
      }
    });
    rList.forEach(function (r) {
      if (r) {
        var item = {};
        r.split(',').forEach(function (val, colIndex) {
          item[fields[colIndex]] = replaceDoubleQuotation(val);
        });
        rows.push(item);
      }
    });
  }

  return {
    fields: fields,
    rows: rows
  };
}

function checkImportData(columns, fields, rows) {
  var tableFields = [];
  columns.forEach(function (column) {
    var field = column.property;

    if (field) {
      tableFields.push(field);
    }
  });
  return tableFields.every(function (field) {
    return fields.includes(field);
  });
}

function importXLSX(params) {
  var $table = params.$table,
      columns = params.columns,
      options = params.options,
      file = params.file;
  var _importCallback = $table._importCallback;
  var fileReader = new FileReader();

  fileReader.onload = function (e) {
    var workbook = XLSX.read(e.target.result, {
      type: 'binary'
    });
    var csvData = XLSX.utils.sheet_to_csv(workbook.Sheets.Sheet1);
    var rest = parseCsv(columns, csvData);
    var fields = rest.fields,
        rows = rest.rows;
    var status = checkImportData(columns, fields, rows);

    if (status) {
      $table.createData(rows).then(function (data) {
        if (options.mode === 'append') {
          $table.insertAt(data, -1);
        } else {
          $table.reloadData(data);
        }
      });

      if (options.message !== false) {
        $table.$XModal.message({
          message: i18n('vxe.table.impSuccess'),
          status: 'success'
        });
      }
    } else if (options.message !== false) {
      $table.$XModal.message({
        message: i18n('vxe.error.impFields'),
        status: 'error'
      });
    }

    if (_importCallback) {
      _importCallback(status);
    }
  };

  fileReader.readAsBinaryString(file);
}

function handleImportEvent(params) {
  switch (params.options.type) {
    case 'xlsx':
      importXLSX(params);
      return false;
  }
}

function handleExportEvent(params) {
  switch (params.options.type) {
    case 'xlsx':
      exportXLSX(params);
      return false;
  }
}
/**
 * 基于 vxe-table 表格的增强插件，支持导出 xlsx 等格式
 */


var VXETablePluginExport = {
  install: function install(xtable) {
    Object.assign(xtable.types, {
      xlsx: 1
    });
    xtable.interceptor.mixin({
      'event.import': handleImportEvent,
      'event.export': handleExportEvent
    });
    VXETablePluginExport.t = xtable.t;
  }
};
exports.VXETablePluginExport = VXETablePluginExport;

function i18n(key) {
  if (VXETablePluginExport.t) {
    return VXETablePluginExport.t(key);
  }
}

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginExport);
}

var _default = VXETablePluginExport;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbInRvQnVmZmVyIiwid2JvdXQiLCJidWYiLCJBcnJheUJ1ZmZlciIsImxlbmd0aCIsInZpZXciLCJVaW50OEFycmF5IiwiaW5kZXgiLCJjaGFyQ29kZUF0IiwiZXhwb3J0WExTWCIsInBhcmFtcyIsIiR0YWJsZSIsIm9wdGlvbnMiLCJjb2x1bW5zIiwiZGF0YXMiLCJzaGVldE5hbWUiLCJ0eXBlIiwiaXNIZWFkZXIiLCJpc0Zvb3RlciIsIm9yaWdpbmFsIiwibWVzc2FnZSIsImZvb3RlckZpbHRlck1ldGhvZCIsImNvbEhlYWQiLCJmb290TGlzdCIsImZvckVhY2giLCJjb2x1bW4iLCJpZCIsInByb3BlcnR5IiwiZ2V0VGl0bGUiLCJyb3dMaXN0IiwibWFwIiwicm93IiwiaXRlbSIsIlhFVXRpbHMiLCJnZXQiLCJmb290ZXJEYXRhIiwiZm9vdGVycyIsImZpbHRlciIsInJvd3MiLCJnZXRDb2x1bW5JbmRleCIsInB1c2giLCJib29rIiwiWExTWCIsInV0aWxzIiwiYm9va19uZXciLCJzaGVldCIsImpzb25fdG9fc2hlZXQiLCJjb25jYXQiLCJza2lwSGVhZGVyIiwiYm9va19hcHBlbmRfc2hlZXQiLCJ3cml0ZSIsImJvb2tUeXBlIiwiYm9va1NTVCIsImJsb2IiLCJCbG9iIiwiZG93bmxvYWRGaWxlIiwiJFhNb2RhbCIsImkxOG4iLCJzdGF0dXMiLCJ3aW5kb3ciLCJmaWxlbmFtZSIsIm5hdmlnYXRvciIsIm1zU2F2ZUJsb2IiLCJsaW5rRWxlbSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRhcmdldCIsImRvd25sb2FkIiwiaHJlZiIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImNsaWNrIiwicmVtb3ZlQ2hpbGQiLCJjb25zb2xlIiwiZXJyb3IiLCJyZXBsYWNlRG91YmxlUXVvdGF0aW9uIiwidmFsIiwicmVwbGFjZSIsInBhcnNlQ3N2IiwiY29udGVudCIsImxpc3QiLCJzcGxpdCIsImZpZWxkcyIsInJMaXN0Iiwic2xpY2UiLCJmaWVsZCIsInIiLCJjb2xJbmRleCIsImNoZWNrSW1wb3J0RGF0YSIsInRhYmxlRmllbGRzIiwiZXZlcnkiLCJpbmNsdWRlcyIsImltcG9ydFhMU1giLCJmaWxlIiwiX2ltcG9ydENhbGxiYWNrIiwiZmlsZVJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJlIiwid29ya2Jvb2siLCJyZWFkIiwicmVzdWx0IiwiY3N2RGF0YSIsInNoZWV0X3RvX2NzdiIsIlNoZWV0cyIsIlNoZWV0MSIsInJlc3QiLCJjcmVhdGVEYXRhIiwidGhlbiIsImRhdGEiLCJtb2RlIiwiaW5zZXJ0QXQiLCJyZWxvYWREYXRhIiwicmVhZEFzQmluYXJ5U3RyaW5nIiwiaGFuZGxlSW1wb3J0RXZlbnQiLCJoYW5kbGVFeHBvcnRFdmVudCIsIlZYRVRhYmxlUGx1Z2luRXhwb3J0IiwiaW5zdGFsbCIsInh0YWJsZSIsIk9iamVjdCIsImFzc2lnbiIsInR5cGVzIiwieGxzeCIsImludGVyY2VwdG9yIiwibWl4aW4iLCJ0Iiwia2V5IiwiVlhFVGFibGUiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7Ozs7Ozs7QUFFQSxTQUFTQSxRQUFULENBQWtCQyxLQUFsQixFQUE0QjtBQUMxQixNQUFJQyxHQUFHLEdBQUcsSUFBSUMsV0FBSixDQUFnQkYsS0FBSyxDQUFDRyxNQUF0QixDQUFWO0FBQ0EsTUFBSUMsSUFBSSxHQUFHLElBQUlDLFVBQUosQ0FBZUosR0FBZixDQUFYOztBQUNBLE9BQUssSUFBSUssS0FBSyxHQUFHLENBQWpCLEVBQW9CQSxLQUFLLEtBQUtOLEtBQUssQ0FBQ0csTUFBcEMsRUFBNEMsRUFBRUcsS0FBOUM7QUFBcURGLElBQUFBLElBQUksQ0FBQ0UsS0FBRCxDQUFKLEdBQWNOLEtBQUssQ0FBQ08sVUFBTixDQUFpQkQsS0FBakIsSUFBMEIsSUFBeEM7QUFBckQ7O0FBQ0EsU0FBT0wsR0FBUDtBQUNEOztBQUVELFNBQVNPLFVBQVQsQ0FB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QUw7QUFDRVAsTUFBQUEsVUFBVSxDQUFDQyxNQUFELENBQVY7QUFDQSxhQUFPLEtBQVA7QUFISjtBQUtEO0FBRUQ7Ozs7O0FBR08sSUFBTTRHLG9CQUFvQixHQUFRO0FBQ3ZDQyxFQUFBQSxPQUR1QyxtQkFDL0JDLE1BRCtCLEVBQ1I7QUFDN0JDLElBQUFBLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixNQUFNLENBQUNHLEtBQXJCLEVBQTRCO0FBQUVDLE1BQUFBLElBQUksRUFBRTtBQUFSLEtBQTVCO0FBQ0FKLElBQUFBLE1BQU0sQ0FBQ0ssV0FBUCxDQUFtQkMsS0FBbkIsQ0FBeUI7QUFDdkIsc0JBQWdCVixpQkFETztBQUV2QixzQkFBZ0JDO0FBRk8sS0FBekI7QUFJQUMsSUFBQUEsb0JBQW9CLENBQUNTLENBQXJCLEdBQXlCUCxNQUFNLENBQUNPLENBQWhDO0FBQ0Q7QUFSc0MsQ0FBbEM7OztBQVdQLFNBQVN0RSxJQUFULENBQWN1RSxHQUFkLEVBQXlCO0FBQ3ZCLE1BQUlWLG9CQUFvQixDQUFDUyxDQUF6QixFQUE0QjtBQUMxQixXQUFPVCxvQkFBb0IsQ0FBQ1MsQ0FBckIsQ0FBdUJDLEdBQXZCLENBQVA7QUFDRDtBQUNGOztBQUVELElBQUksT0FBT3JFLE1BQVAsS0FBa0IsV0FBbEIsSUFBaUNBLE1BQU0sQ0FBQ3NFLFFBQTVDLEVBQXNEO0FBQ3BEdEUsRUFBQUEsTUFBTSxDQUFDc0UsUUFBUCxDQUFnQkMsR0FBaEIsQ0FBb0JaLG9CQUFwQjtBQUNEOztlQUVjQSxvQiIsImZpbGUiOiJpbmRleC5jb21tb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgWEVVdGlscyBmcm9tICd4ZS11dGlscy9tZXRob2RzL3hlLXV0aWxzJ1xyXG5pbXBvcnQgVlhFVGFibGUgZnJvbSAndnhlLXRhYmxlL2xpYi92eGUtdGFibGUnXHJcbmltcG9ydCAqIGFzIFhMU1ggZnJvbSAneGxzeCdcclxuXHJcbmZ1bmN0aW9uIHRvQnVmZmVyKHdib3V0OiBhbnkpIHtcclxuICBsZXQgYnVmID0gbmV3IEFycmF5QnVmZmVyKHdib3V0Lmxlbmd0aClcclxuICBsZXQgdmlldyA9IG5ldyBVaW50OEFycmF5KGJ1ZilcclxuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4ICE9PSB3Ym91dC5sZW5ndGg7ICsraW5kZXgpIHZpZXdbaW5kZXhdID0gd2JvdXQuY2hhckNvZGVBdChpbmRleCkgJiAweEZGXHJcbiAgcmV0dXJuIGJ1ZlxyXG59XHJcblxyXG5mdW5jdGlvbiBleHBvcnRYTFNYKHBhcmFtczogYW55KSB7XHJcbiAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMsIGNvbHVtbnMsIGRhdGFzIH0gPSBwYXJhbXNcclxuICBjb25zdCB7IHNoZWV0TmFtZSwgdHlwZSwgaXNIZWFkZXIsIGlzRm9vdGVyLCBvcmlnaW5hbCwgbWVzc2FnZSwgZm9vdGVyRmlsdGVyTWV0aG9kIH0gPSBvcHRpb25zXHJcbiAgY29uc3QgY29sSGVhZDogYW55ID0ge31cclxuICBjb25zdCBmb290TGlzdDogYW55W10gPSBbXVxyXG4gIGlmIChpc0hlYWRlcikge1xyXG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW46IGFueSkgPT4ge1xyXG4gICAgICBjb2xIZWFkW2NvbHVtbi5pZF0gPSAob3JpZ2luYWwgPyBjb2x1bW4ucHJvcGVydHkgOiBjb2x1bW4uZ2V0VGl0bGUoKSkgfHwgJydcclxuICAgIH0pXHJcbiAgfVxyXG4gIGNvbnN0IHJvd0xpc3QgPSBkYXRhcy5tYXAoKHJvdzogYW55KSA9PiB7XHJcbiAgICBjb25zdCBpdGVtOiBhbnkgPSB7fVxyXG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW46IGFueSkgPT4ge1xyXG4gICAgICBpdGVtW2NvbHVtbi5pZF0gPSBvcmlnaW5hbCA/IFhFVXRpbHMuZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KSA6IHJvd1tjb2x1bW4uaWRdXHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIGl0ZW1cclxuICB9KVxyXG4gIGlmIChpc0Zvb3Rlcikge1xyXG4gICAgY29uc3QgZm9vdGVyRGF0YSA9ICR0YWJsZS5mb290ZXJEYXRhXHJcbiAgICBjb25zdCBmb290ZXJzID0gZm9vdGVyRmlsdGVyTWV0aG9kID8gZm9vdGVyRGF0YS5maWx0ZXIoZm9vdGVyRmlsdGVyTWV0aG9kKSA6IGZvb3RlckRhdGFcclxuICAgIGZvb3RlcnMuZm9yRWFjaCgocm93czogYW55W10pID0+IHtcclxuICAgICAgY29uc3QgaXRlbTogYW55ID0ge31cclxuICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW46IGFueSkgPT4ge1xyXG4gICAgICAgIGl0ZW1bY29sdW1uLmlkXSA9IHJvd3NbJHRhYmxlLmdldENvbHVtbkluZGV4KGNvbHVtbildIHx8ICcnXHJcbiAgICAgIH0pXHJcbiAgICAgIGZvb3RMaXN0LnB1c2goaXRlbSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIGNvbnN0IGJvb2sgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KClcclxuICBjb25zdCBzaGVldCA9IFhMU1gudXRpbHMuanNvbl90b19zaGVldCgoaXNIZWFkZXIgPyBbY29sSGVhZF0gOiBbXSkuY29uY2F0KHJvd0xpc3QpLmNvbmNhdChmb290TGlzdCksIHsgc2tpcEhlYWRlcjogdHJ1ZSB9KVxyXG4gIC8vIOi9rOaNouaVsOaNrlxyXG4gIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQoYm9vaywgc2hlZXQsIHNoZWV0TmFtZSlcclxuICBjb25zdCB3Ym91dCA9IFhMU1gud3JpdGUoYm9vaywgeyBib29rVHlwZTogdHlwZSwgYm9va1NTVDogZmFsc2UsIHR5cGU6ICdiaW5hcnknIH0pXHJcbiAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFt0b0J1ZmZlcih3Ym91dCldLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nIH0pXHJcbiAgLy8g5L+d5a2Y5a+85Ye6XHJcbiAgZG93bmxvYWRGaWxlKGJsb2IsIG9wdGlvbnMpXHJcbiAgaWYgKG1lc3NhZ2UgIT09IGZhbHNlKSB7XHJcbiAgICAkdGFibGUuJFhNb2RhbC5tZXNzYWdlKHsgbWVzc2FnZTogaTE4bigndnhlLnRhYmxlLmV4cFN1Y2Nlc3MnKSwgc3RhdHVzOiAnc3VjY2VzcycgfSlcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRvd25sb2FkRmlsZShibG9iOiBCbG9iLCBvcHRpb25zOiBhbnkpIHtcclxuICBpZiAod2luZG93LkJsb2IpIHtcclxuICAgIGNvbnN0IHsgZmlsZW5hbWUsIHR5cGUgfSA9IG9wdGlvbnNcclxuICAgIGlmIChuYXZpZ2F0b3IubXNTYXZlQmxvYikge1xyXG4gICAgICBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBmaWxlbmFtZSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhciBsaW5rRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKVxyXG4gICAgICBsaW5rRWxlbS50YXJnZXQgPSAnX2JsYW5rJ1xyXG4gICAgICBsaW5rRWxlbS5kb3dubG9hZCA9IGAke2ZpbGVuYW1lfS4ke3R5cGV9YFxyXG4gICAgICBsaW5rRWxlbS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKVxyXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmtFbGVtKVxyXG4gICAgICBsaW5rRWxlbS5jbGljaygpXHJcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGlua0VsZW0pXHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoaTE4bigndnhlLmVycm9yLm5vdEV4cCcpKVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcmVwbGFjZURvdWJsZVF1b3RhdGlvbih2YWw6IHN0cmluZykge1xyXG4gIHJldHVybiB2YWwucmVwbGFjZSgvXlwiLywgJycpLnJlcGxhY2UoL1wiJC8sICcnKVxyXG59XHJcblxyXG5mdW5jdGlvbiBwYXJzZUNzdihjb2x1bW5zOiBhbnlbXSwgY29udGVudDogc3RyaW5nKSB7XHJcbiAgY29uc3QgbGlzdDogc3RyaW5nW10gPSBjb250ZW50LnNwbGl0KCdcXG4nKVxyXG4gIGNvbnN0IGZpZWxkczogYW55W10gPSBbXVxyXG4gIGNvbnN0IHJvd3M6IGFueVtdID0gW11cclxuICBpZiAobGlzdC5sZW5ndGgpIHtcclxuICAgIGNvbnN0IHJMaXN0OiBzdHJpbmdbXSA9IGxpc3Quc2xpY2UoMSlcclxuICAgIGxpc3RbMF0uc3BsaXQoJywnKS5mb3JFYWNoKCh2YWw6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBmaWVsZDogc3RyaW5nID0gcmVwbGFjZURvdWJsZVF1b3RhdGlvbih2YWwpXHJcbiAgICAgIGlmIChmaWVsZCkge1xyXG4gICAgICAgIGZpZWxkcy5wdXNoKGZpZWxkKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgckxpc3QuZm9yRWFjaCgocjogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmIChyKSB7XHJcbiAgICAgICAgY29uc3QgaXRlbTogYW55ID0ge31cclxuICAgICAgICByLnNwbGl0KCcsJykuZm9yRWFjaCgodmFsOiBzdHJpbmcsIGNvbEluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgIGl0ZW1bZmllbGRzW2NvbEluZGV4XV0gPSByZXBsYWNlRG91YmxlUXVvdGF0aW9uKHZhbClcclxuICAgICAgICB9KVxyXG4gICAgICAgIHJvd3MucHVzaChpdGVtKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuICByZXR1cm4geyBmaWVsZHMsIHJvd3MgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja0ltcG9ydERhdGEoY29sdW1uczogYW55W10sIGZpZWxkczogc3RyaW5nW10sIHJvd3M6IGFueVtdKSB7XHJcbiAgbGV0IHRhYmxlRmllbGRzOiBzdHJpbmdbXSA9IFtdXHJcbiAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW46IGFueSkgPT4ge1xyXG4gICAgbGV0IGZpZWxkOiBzdHJpbmcgPSBjb2x1bW4ucHJvcGVydHlcclxuICAgIGlmIChmaWVsZCkge1xyXG4gICAgICB0YWJsZUZpZWxkcy5wdXNoKGZpZWxkKVxyXG4gICAgfVxyXG4gIH0pXHJcbiAgcmV0dXJuIHRhYmxlRmllbGRzLmV2ZXJ5KChmaWVsZDogc3RyaW5nKSA9PiBmaWVsZHMuaW5jbHVkZXMoZmllbGQpKVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbXBvcnRYTFNYKHBhcmFtczogYW55KSB7XHJcbiAgY29uc3QgeyAkdGFibGUsIGNvbHVtbnMsIG9wdGlvbnMsIGZpbGUgfSA9IHBhcmFtc1xyXG4gIGNvbnN0IHsgX2ltcG9ydENhbGxiYWNrIH0gPSAkdGFibGVcclxuICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxyXG4gIGZpbGVSZWFkZXIub25sb2FkID0gKGU6IGFueSkgPT4ge1xyXG4gICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnJlYWQoZS50YXJnZXQucmVzdWx0LCB7IHR5cGU6ICdiaW5hcnknIH0pXHJcbiAgICBjb25zdCBjc3ZEYXRhOiBzdHJpbmcgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2Nzdih3b3JrYm9vay5TaGVldHMuU2hlZXQxKVxyXG4gICAgY29uc3QgcmVzdDogYW55ID0gcGFyc2VDc3YoY29sdW1ucywgY3N2RGF0YSlcclxuICAgIGNvbnN0IHsgZmllbGRzLCByb3dzIH0gPSByZXN0XHJcbiAgICBjb25zdCBzdGF0dXMgPSBjaGVja0ltcG9ydERhdGEoY29sdW1ucywgZmllbGRzLCByb3dzKVxyXG4gICAgaWYgKHN0YXR1cykge1xyXG4gICAgICAkdGFibGUuY3JlYXRlRGF0YShyb3dzKVxyXG4gICAgICAgIC50aGVuKChkYXRhOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgaWYgKG9wdGlvbnMubW9kZSA9PT0gJ2FwcGVuZCcpIHtcclxuICAgICAgICAgICAgJHRhYmxlLmluc2VydEF0KGRhdGEsIC0xKVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHRhYmxlLnJlbG9hZERhdGEoZGF0YSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICBpZiAob3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZSkge1xyXG4gICAgICAgICR0YWJsZS4kWE1vZGFsLm1lc3NhZ2UoeyBtZXNzYWdlOiBpMThuKCd2eGUudGFibGUuaW1wU3VjY2VzcycpLCBzdGF0dXM6ICdzdWNjZXNzJyB9KVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKG9wdGlvbnMubWVzc2FnZSAhPT0gZmFsc2UpIHtcclxuICAgICAgJHRhYmxlLiRYTW9kYWwubWVzc2FnZSh7IG1lc3NhZ2U6IGkxOG4oJ3Z4ZS5lcnJvci5pbXBGaWVsZHMnKSwgc3RhdHVzOiAnZXJyb3InIH0pXHJcbiAgICB9XHJcbiAgICBpZiAoX2ltcG9ydENhbGxiYWNrKSB7XHJcbiAgICAgIF9pbXBvcnRDYWxsYmFjayhzdGF0dXMpXHJcbiAgICB9XHJcbiAgfVxyXG4gIGZpbGVSZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUltcG9ydEV2ZW50KHBhcmFtczogYW55KSB7XHJcbiAgc3dpdGNoIChwYXJhbXMub3B0aW9ucy50eXBlKSB7XHJcbiAgICBjYXNlICd4bHN4JzpcclxuICAgICAgaW1wb3J0WExTWChwYXJhbXMpXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRXhwb3J0RXZlbnQocGFyYW1zOiBhbnkpIHtcclxuICBzd2l0Y2ggKHBhcmFtcy5vcHRpb25zLnR5cGUpIHtcclxuICAgIGNhc2UgJ3hsc3gnOlxyXG4gICAgICBleHBvcnRYTFNYKHBhcmFtcylcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlop7lvLrmj5Lku7bvvIzmlK/mjIHlr7zlh7ogeGxzeCDnrYnmoLzlvI9cclxuICovXHJcbmV4cG9ydCBjb25zdCBWWEVUYWJsZVBsdWdpbkV4cG9ydDogYW55ID0ge1xyXG4gIGluc3RhbGwoeHRhYmxlOiB0eXBlb2YgVlhFVGFibGUpIHtcclxuICAgIE9iamVjdC5hc3NpZ24oeHRhYmxlLnR5cGVzLCB7IHhsc3g6IDEgfSlcclxuICAgIHh0YWJsZS5pbnRlcmNlcHRvci5taXhpbih7XHJcbiAgICAgICdldmVudC5pbXBvcnQnOiBoYW5kbGVJbXBvcnRFdmVudCxcclxuICAgICAgJ2V2ZW50LmV4cG9ydCc6IGhhbmRsZUV4cG9ydEV2ZW50XHJcbiAgICB9KVxyXG4gICAgVlhFVGFibGVQbHVnaW5FeHBvcnQudCA9IHh0YWJsZS50XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpMThuKGtleTogc3RyaW5nKSB7XHJcbiAgaWYgKFZYRVRhYmxlUGx1Z2luRXhwb3J0LnQpIHtcclxuICAgIHJldHVybiBWWEVUYWJsZVBsdWdpbkV4cG9ydC50KGtleSlcclxuICB9XHJcbn1cclxuXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luRXhwb3J0KVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBWWEVUYWJsZVBsdWdpbkV4cG9ydFxyXG4iXX0=
